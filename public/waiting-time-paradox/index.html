<!DOCTYPE html>
<html lang="en_gb">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Waiting time paradox - Fabian Gunzinger</title><meta name="Description" content=""><meta property="og:title" content="Waiting time paradox" />
<meta property="og:description" content="This notebook replicates Jake VanderPlas&rsquo; awesome post on the topic.
Background The waiting-time paradox is a special case of the inspection paradox, which &ndash; as VanderPlas succinctly summarises &ndash; occurs whenever the probability of observing a quantity is related to the quantity being observed. For example: if you sample random students on campus and ask them about the size of their classes you&rsquo;ll probably get a larger number than if you asked the collge administrator, because you&rsquo;re likely to oversample students from large classes." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/waiting-time-paradox/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-01-14T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-10-02T08:42:30+01:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Waiting time paradox"/>
<meta name="twitter:description" content="This notebook replicates Jake VanderPlas&rsquo; awesome post on the topic.
Background The waiting-time paradox is a special case of the inspection paradox, which &ndash; as VanderPlas succinctly summarises &ndash; occurs whenever the probability of observing a quantity is related to the quantity being observed. For example: if you sample random students on campus and ask them about the size of their classes you&rsquo;ll probably get a larger number than if you asked the collge administrator, because you&rsquo;re likely to oversample students from large classes."/>
<meta name="application-name" content="Fabian Gunzinger">
<meta name="apple-mobile-web-app-title" content="Fabian Gunzinger"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://example.org/waiting-time-paradox/" /><link rel="prev" href="http://example.org/naive-bayes/" /><link rel="next" href="http://example.org/seattle-bicycle-traffic/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Waiting time paradox",
        "inLanguage": "en_gb",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/example.org\/waiting-time-paradox\/"
        },"genre": "posts","keywords": "datascience","wordcount":  2177 ,
        "url": "http:\/\/example.org\/waiting-time-paradox\/","datePublished": "2020-01-14T00:00:00+00:00","dateModified": "2023-10-02T08:42:30+01:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Author"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Fabian Gunzinger"></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/"> Home </a><a class="menu-item" href="/research/"> Research </a><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Fabian Gunzinger"></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/" title="">Home</a><a class="menu-item" href="/research/" title="">Research</a><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Waiting time paradox</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Author</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2020-01-14">2020-01-14</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;2177 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;11 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="true">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#background">Background</a></li>
    <li><a href="#simulating-wait-times">Simulating wait times</a></li>
    <li><a href="#digging-deeper">Digging deeper</a></li>
    <li><a href="#choosing-pt">Choosing p(T)</a></li>
    <li><a href="#waiting-times-in-reality">Waiting times in reality</a>
      <ul>
        <li><a href="#data-cleanup">Data cleanup</a></li>
      </ul>
    </li>
    <li><a href="#how-late-are-buses">How late are buses?</a></li>
    <li><a href="#scheduled-and-observed-arrival-intervals">Scheduled and observed arrival intervals</a></li>
    <li><a href="#simulate-waiting-times">Simulate waiting times</a></li>
    <li><a href="#unsolved-issues">Unsolved issues</a></li>
    <li><a href="#cool-stuff-picked-up-while-working-through-this">Cool stuff picked up while working through this</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<p>This notebook replicates Jake VanderPlas&rsquo; awesome <a href="http://jakevdp.github.io/blog/2018/09/13/waiting-time-paradox/" target="_blank" rel="noopener noreffer ">post</a> on the topic.</p>
<h2 id="background">Background</h2>
<p>The waiting-time paradox is a special case of the <a href="https://towardsdatascience.com/the-inspection-paradox-is-everywhere-2ef1c2e9d709" target="_blank" rel="noopener noreffer ">inspection paradox</a>, which &ndash; as VanderPlas succinctly summarises &ndash; occurs whenever the probability of observing a quantity is related to the quantity being observed. For example: if you sample random students on campus and ask them about the size of their classes you&rsquo;ll probably get a larger number than if you asked the collge administrator, because you&rsquo;re likely to oversample students from large classes. Similarly, you are more likely to arrive at a bus stop during a longer waiting time simply because the waiting time is longer.</p>
<p>However, the waiting time paradox claims not only that the experienced waiting time is longer than the average waiting time, but that it is twice as long.</p>
<h2 id="simulating-wait-times">Simulating wait times</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">random</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span><span class="p">,</span> <span class="n">poisson</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&#34;seaborn&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Helper functions</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">simulate_bus_arrivals</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">rseed</span><span class="o">=</span><span class="mi">231296</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Simulates the arrival of n buses that are scheduled to arrive every tau minutes.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">rseed</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">n</span> <span class="o">*</span> <span class="n">tau</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">simulate_wait_times</span><span class="p">(</span><span class="n">arrival_times</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span> <span class="n">rseed</span><span class="o">=</span><span class="mi">231286</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Calculate the waiting time for each arriving passenger.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Simulate customer arrival times (between 0 and arrival of last bus)</span>
</span></span><span class="line"><span class="cl">    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">rseed</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">arrival_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arrival_times</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">passenger_times</span> <span class="o">=</span> <span class="n">arrival_times</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Find the index of the next bus for each simulated customer</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">arrival_times</span><span class="p">,</span> <span class="n">passenger_times</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s2">&#34;right&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">arrival_times</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">passenger_times</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Create bus arrival times and check that frequency is about tau</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">bus_arrival_times</span> <span class="o">=</span> <span class="n">simulate_bus_arrivals</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">rseed</span><span class="o">=</span><span class="mi">231286</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">intervals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">bus_arrival_times</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">intervals</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>9.9999994693088
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Calculate passenger waiting times</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">wait_times</span> <span class="o">=</span> <span class="n">simulate_wait_times</span><span class="p">(</span><span class="n">bus_arrival_times</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">wait_times</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>10.00276398808929
</code></pre>
<p>This is in line with the paradox: if buses arrive every 10 minutes on average, the the average wait time is not 5 minutes, but 10 mintues.</p>
<h2 id="digging-deeper">Digging deeper</h2>
<p>To model the above result analytically, let&rsquo;s model the process we generated to calculate waiting times and then derive the expected waiting time.</p>
<p>For a start, we can write the expected value of intervals $T$ between bus arrivals as</p>
<p>$$ E(T) = \int_{0}^{\infty} Tp(T)dT $$.</p>
<p>In the simulation above, we set $E(T) = \tau = 10$ minutes.</p>
<p>What we&rsquo;re after, however, is the expected value of the waiting time for a rider who arrives at the bus stop. To get this, we first model the distribution of experienced waiting times for customers, and then recognise that the expected value of the waiting time is half the expected value for the experienced waiting time.</p>
<p>From the inspection paradox, we know that the experienced waiting time depends on the actual intervals between buses, $p(T)$ as well as on the length of the intervals, $T$. So we can write</p>
<p>$$ p_{exp}(T) \propto Tp(T)$$.</p>
<p>Substitute the constant of proportionality for the proportional sign seemed obvious for jvdp, but was less so for me, so I&rsquo;m gonna back up and explain, based on <a href="https://davidrosenberg.github.io/mlcourse/Notes/proportionality.pdf" target="_blank" rel="noopener noreffer ">this</a> super helpful resource.</p>
<p>If $ p_{exp}(T) Tp(T)$, then we know that there exists a constant of proportionality $k$ such that</p>
<p>$$ p_{exp}(T) = kTp(T)$$.</p>
<p>Because $p_{exp}(T)$ is a density, we have $\int_0^\infty p_{exp}(T)dT = 1$, which means that</p>
<p>$$\int_0^\infty kTp(T)dT = 1$$
$$k\int_0^\infty Tp(T)dT = 1$$
$$k = \left[\int_0^\infty kTp(T)dT\right]^{-1}$$</p>
<p>Using this in our expression above, we get</p>
<p>$$p_{exp}(T) = \frac{Tp(T)}{\int_0^\infty Tp(T)dT}$$.</p>
<p>And using the definition of $E(T)$ above, this simplifies to</p>
<p>$$p_{exp}(T) = \frac{Tp(T)}{E(T)}$$.</p>
<p>To find the expected waiting time $E(W)$, the final step is use the fact that the expected value for the observed interval is half the expected interval (if riders experience buses at arriving every 20 minutes, then their expected waiting time is 10 minutes). We can thus write:</p>
<p>$$E(W) = \frac{1}{2} E_{exp}(T) = \frac{1}{2} \int_{0}^{\infty} Tp_{exp}(T)dT$$.</p>
<p>Using our expression from above and rewriting gives</p>
<p>$$
E(W) = \frac{1}{2} \int_{0}^{\infty} T\frac{Tp(T)}{E(T)}dT
E(W) = \frac{1}{2E(T)} \int_{0}^{\infty} T^2p(T)dT
E(W) =\frac{E(T^2)}{2E(T)}
$$.</p>
<p>What we now need to do is to find a form for $p(T)$ and compute our integrals.</p>
<h2 id="choosing-pt">Choosing p(T)</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Plot distribution of simulated intervals</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">intervals</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">80</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">intervals</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&#34;black&#34;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&#34;dotted&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&#34;Interval between arrivals (minutes)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&#34;Probability density&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="waiting-time-paradox_files/figure-markdown_strict/cell-6-output-1.png"
        data-srcset="waiting-time-paradox_files/figure-markdown_strict/cell-6-output-1.png, waiting-time-paradox_files/figure-markdown_strict/cell-6-output-1.png 1.5x, waiting-time-paradox_files/figure-markdown_strict/cell-6-output-1.png 2x"
        data-sizes="auto"
        alt="waiting-time-paradox_files/figure-markdown_strict/cell-6-output-1.png"
        title="waiting-time-paradox_files/figure-markdown_strict/cell-6-output-1.png" /></p>
<p>The distribution of intervals is clearly exponential. The original post describes in some more detail why this was to be expected given that we sampled arrival times from a uniform distribution. The short answer is: random selection from a uniform distribution approximates a poisson process, and the distribution of intervals of a poisson process is exponential. Let&rsquo;s thus check whether our arrival times do indeed follow a poisson distribution.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Count number of arrivals for each 1-hour interval</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">binsize</span> <span class="o">=</span> <span class="mi">60</span>
</span></span><span class="line"><span class="cl"><span class="n">binned_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">bus_arrival_times</span><span class="p">)</span> <span class="o">//</span> <span class="n">binsize</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&#34;int&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Plot results and compare with poisson distribution</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">tau</span> <span class="o">=</span> <span class="mi">10</span>
</span></span><span class="line"><span class="cl"><span class="n">mu</span> <span class="o">=</span> <span class="n">binsize</span> <span class="o">/</span> <span class="n">tau</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">binned_counts</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">bins</span><span class="o">=</span><span class="n">x</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">label</span><span class="o">=</span><span class="s2">&#34;Simulation&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">poisson</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">),</span> <span class="s2">&#34;ok&#34;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&#34;Poisson prediction&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="waiting-time-paradox_files/figure-markdown_strict/cell-7-output-1.png"
        data-srcset="waiting-time-paradox_files/figure-markdown_strict/cell-7-output-1.png, waiting-time-paradox_files/figure-markdown_strict/cell-7-output-1.png 1.5x, waiting-time-paradox_files/figure-markdown_strict/cell-7-output-1.png 2x"
        data-sizes="auto"
        alt="waiting-time-paradox_files/figure-markdown_strict/cell-7-output-1.png"
        title="waiting-time-paradox_files/figure-markdown_strict/cell-7-output-1.png" /></p>
<p>It&rsquo;s clear that the poisson distribution approximates our distribution of simulated arrivals very well. This means that we can write the probability distribution of our intervals as &hellip;</p>
<p>&hellip;</p>
<p>jvdp gets $p(T) = \frac{1}{\tau}e^{-T/\tau}$</p>
<p>I can&rsquo;t see where this is coming from. Following the logic of <a href="https://nicolewhite.github.io/2015/05/23/understanding-waiting-times.html" target="_blank" rel="noopener noreffer ">this</a> post, I get $p(T) = -e^{T/\tau}$</p>
<h2 id="waiting-times-in-reality">Waiting times in reality</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Load data</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&#34;./data/bus_paradox_arrival_times.csv&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&#34;any&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
<thead>
<tr>
<th></th>
<th>OPD_DATE</th>
<th>VEHICLE_ID</th>
<th>RTE</th>
<th>DIR</th>
<th>TRIP_ID</th>
<th>STOP_ID</th>
<th>STOP_NAME</th>
<th>SCH_STOP_TM</th>
<th>ACT_STOP_TM</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>2016-03-26</td>
<td>6201</td>
<td>673</td>
<td>S</td>
<td>30908177</td>
<td>431</td>
<td>3RD AVE &amp; PIKE ST (431)</td>
<td>01:11:57</td>
<td>01:13:19</td>
</tr>
<tr>
<td>1</td>
<td>2016-03-26</td>
<td>6201</td>
<td>673</td>
<td>S</td>
<td>30908033</td>
<td>431</td>
<td>3RD AVE &amp; PIKE ST (431)</td>
<td>23:19:57</td>
<td>23:16:13</td>
</tr>
<tr>
<td>2</td>
<td>2016-03-26</td>
<td>6201</td>
<td>673</td>
<td>S</td>
<td>30908028</td>
<td>431</td>
<td>3RD AVE &amp; PIKE ST (431)</td>
<td>21:19:57</td>
<td>21:18:46</td>
</tr>
<tr>
<td>3</td>
<td>2016-03-26</td>
<td>6201</td>
<td>673</td>
<td>S</td>
<td>30908019</td>
<td>431</td>
<td>3RD AVE &amp; PIKE ST (431)</td>
<td>19:04:57</td>
<td>19:01:49</td>
</tr>
<tr>
<td>4</td>
<td>2016-03-26</td>
<td>6201</td>
<td>673</td>
<td>S</td>
<td>30908252</td>
<td>431</td>
<td>3RD AVE &amp; PIKE ST (431)</td>
<td>16:42:57</td>
<td>16:42:39</td>
</tr>
</tbody>
</table>
</div>
<h3 id="data-cleanup">Data cleanup</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Combine time and data into single timestamp</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;actual&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;OPD_DATE&#34;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&#34; &#34;</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;ACT_STOP_TM&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;scheduled&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;OPD_DATE&#34;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&#34; &#34;</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;SCH_STOP_TM&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Calculate dalay in minutes, adjusting actual day when actual and scheduled span midnight</span>
</span></span><span class="line"><span class="cl"><span class="n">minute</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;m&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">hour</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="n">minute</span>
</span></span><span class="line"><span class="cl"><span class="n">diff_hrs</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;actual&#34;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;scheduled&#34;</span><span class="p">])</span> <span class="o">/</span> <span class="n">hour</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">diff_hrs</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">22</span><span class="p">,</span> <span class="s2">&#34;actual&#34;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">hour</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">diff_hrs</span> <span class="o">&gt;</span> <span class="mi">22</span><span class="p">,</span> <span class="s2">&#34;actual&#34;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">hour</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;minutes_late&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;actual&#34;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;scheduled&#34;</span><span class="p">])</span> <span class="o">/</span> <span class="n">minute</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Map internal route codes to external route letters</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;route&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;RTE&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">673</span><span class="p">:</span> <span class="s2">&#34;C&#34;</span><span class="p">,</span> <span class="mi">674</span><span class="p">:</span> <span class="s2">&#34;D&#34;</span><span class="p">,</span> <span class="mi">675</span><span class="p">:</span> <span class="s2">&#34;E&#34;</span><span class="p">})</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&#34;category&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;direction&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">[</span><span class="s2">&#34;DIR&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s2">&#34;N&#34;</span><span class="p">:</span> <span class="s2">&#34;northbound&#34;</span><span class="p">,</span> <span class="s2">&#34;S&#34;</span><span class="p">:</span> <span class="s2">&#34;southbound&#34;</span><span class="p">})</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&#34;category&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Extract useful columns</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&#34;route&#34;</span><span class="p">,</span> <span class="s2">&#34;direction&#34;</span><span class="p">,</span> <span class="s2">&#34;scheduled&#34;</span><span class="p">,</span> <span class="s2">&#34;actual&#34;</span><span class="p">,</span> <span class="s2">&#34;minutes_late&#34;</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
<thead>
<tr>
<th></th>
<th>route</th>
<th>direction</th>
<th>scheduled</th>
<th>actual</th>
<th>minutes_late</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>C</td>
<td>southbound</td>
<td>2016-03-26 01:11:57</td>
<td>2016-03-26 01:13:19</td>
<td>1.366667</td>
</tr>
<tr>
<td>1</td>
<td>C</td>
<td>southbound</td>
<td>2016-03-26 23:19:57</td>
<td>2016-03-26 23:16:13</td>
<td>-3.733333</td>
</tr>
<tr>
<td>2</td>
<td>C</td>
<td>southbound</td>
<td>2016-03-26 21:19:57</td>
<td>2016-03-26 21:18:46</td>
<td>-1.183333</td>
</tr>
<tr>
<td>3</td>
<td>C</td>
<td>southbound</td>
<td>2016-03-26 19:04:57</td>
<td>2016-03-26 19:01:49</td>
<td>-3.133333</td>
</tr>
<tr>
<td>4</td>
<td>C</td>
<td>southbound</td>
<td>2016-03-26 16:42:57</td>
<td>2016-03-26 16:42:39</td>
<td>-0.300000</td>
</tr>
</tbody>
</table>
</div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
Int64Index: 38917 entries, 0 to 39156
Data columns (total 5 columns):
 #   Column        Non-Null Count  Dtype         
---  ------        --------------  -----         
 0   route         38917 non-null  category      
 1   direction     38917 non-null  category      
 2   scheduled     38917 non-null  datetime64[ns]
 3   actual        38917 non-null  datetime64[ns]
 4   minutes_late  38917 non-null  float64       
dtypes: category(2), datetime64[ns](2), float64(1)
memory usage: 1.3 MB
</code></pre>
<h2 id="how-late-are-buses">How late are buses?</h2>
<p>We can look at the direction of each route separately to get a sense of the distribution of delays. We can&rsquo;t know this from looking at the data, but the routes are such that the southbound trip for C, and the northbound trip for D and E are near the beginning of the line (i.e.Â C runs from north to south and back to noth). As jvdp notes, we&rsquo;d expect buses to keep more closely to their schedules early in the trip, which is precisely what we can see, which is pretty cool!</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="s2">&#34;direction&#34;</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&#34;route&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">,</span> <span class="s2">&#34;minutes_late&#34;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&#34;k&#34;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&#34;dotted&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">set_titles</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">{col_name}</span><span class="s2"> </span><span class="si">{row_name}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">set_axis_labels</span><span class="p">(</span><span class="s2">&#34;Minutes late&#34;</span><span class="p">,</span> <span class="s2">&#34;Number of buses&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="waiting-time-paradox_files/figure-markdown_strict/cell-11-output-1.png"
        data-srcset="waiting-time-paradox_files/figure-markdown_strict/cell-11-output-1.png, waiting-time-paradox_files/figure-markdown_strict/cell-11-output-1.png 1.5x, waiting-time-paradox_files/figure-markdown_strict/cell-11-output-1.png 2x"
        data-sizes="auto"
        alt="waiting-time-paradox_files/figure-markdown_strict/cell-11-output-1.png"
        title="waiting-time-paradox_files/figure-markdown_strict/cell-11-output-1.png" /></p>
<h2 id="scheduled-and-observed-arrival-intervals">Scheduled and observed arrival intervals</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Calculate actual and scheduled intervals</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">compute_interval</span><span class="p">(</span><span class="n">series</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">minute</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;m&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">series</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span> <span class="o">/</span> <span class="n">minute</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">grouped</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&#34;route&#34;</span><span class="p">,</span> <span class="s2">&#34;direction&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;actual_interval&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grouped</span><span class="p">[</span><span class="s2">&#34;actual&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">compute_interval</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;scheduled_interval&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grouped</span><span class="p">[</span><span class="s2">&#34;scheduled&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">compute_interval</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Plot actual intervals</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="s2">&#34;direction&#34;</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&#34;route&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">,</span> <span class="s2">&#34;actual_interval&#34;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">set_titles</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">{col_name}</span><span class="s2"> </span><span class="si">{row_name}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">set_axis_labels</span><span class="p">(</span><span class="s2">&#34;Actual intervals (minutes)&#34;</span><span class="p">,</span> <span class="s2">&#34;Number of buses&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Plot scheduled intervals</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="s2">&#34;direction&#34;</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&#34;route&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">,</span> <span class="s2">&#34;scheduled_interval&#34;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">set_titles</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">{col_name}</span><span class="s2"> </span><span class="si">{row_name}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">set_axis_labels</span><span class="p">(</span><span class="s2">&#34;Scheduled intervals (minutes)&#34;</span><span class="p">,</span> <span class="s2">&#34;Number of buses&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="waiting-time-paradox_files/figure-markdown_strict/cell-14-output-1.png"
        data-srcset="waiting-time-paradox_files/figure-markdown_strict/cell-14-output-1.png, waiting-time-paradox_files/figure-markdown_strict/cell-14-output-1.png 1.5x, waiting-time-paradox_files/figure-markdown_strict/cell-14-output-1.png 2x"
        data-sizes="auto"
        alt="waiting-time-paradox_files/figure-markdown_strict/cell-14-output-1.png"
        title="waiting-time-paradox_files/figure-markdown_strict/cell-14-output-1.png" /></p>
<p>While actual intervals are clearly not distributed exponentially, the plot of scheduled intervals shows that this might be the case because there are a variety of different scheduled intervals (e.g.Â it&rsquo;s not the case that all buses are scheduled to arrive in 10 minute intervals).</p>
<p>Instead, jvdp proposes a clever workaround: group arrivals by route, direction, and scheduled interval, and then stack these observations together as if they happened in sequence. This preserves the properties of the data, while giving us a situation analogous to our simulation above: a series of buses scheduled to arrive at constant intervals.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Check for most frequent intervals</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;scheduled_interval&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>15.0    7367
12.0    7062
10.0    4879
Name: scheduled_interval, dtype: int64
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">stacked_sequence</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Sort by scheduled arrival time</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&#34;scheduled&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Restack data and compute needed variables</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span><span class="p">[</span><span class="s2">&#34;scheduled&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&#34;scheduled_interval&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span><span class="p">[</span><span class="s2">&#34;actual&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&#34;scheduled&#34;</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s2">&#34;minutes_late&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span><span class="p">[</span><span class="s2">&#34;actual_interval&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&#34;actual&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">subset</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;scheduled_interval&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&#34;10&#34;</span><span class="p">,</span> <span class="s2">&#34;15&#34;</span><span class="p">])]</span>
</span></span><span class="line"><span class="cl"><span class="n">grouped</span> <span class="o">=</span> <span class="n">subset</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&#34;route&#34;</span><span class="p">,</span> <span class="s2">&#34;direction&#34;</span><span class="p">,</span> <span class="s2">&#34;scheduled_interval&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">sequenced</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">stacked_sequence</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sequenced</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
<thead>
<tr>
<th></th>
<th>route</th>
<th>direction</th>
<th>scheduled</th>
<th>actual</th>
<th>minutes_late</th>
<th>actual_interval</th>
<th>scheduled_interval</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>C</td>
<td>northbound</td>
<td>10.0</td>
<td>12.400000</td>
<td>2.400000</td>
<td>NaN</td>
<td>10.0</td>
</tr>
<tr>
<td>1</td>
<td>C</td>
<td>northbound</td>
<td>20.0</td>
<td>27.150000</td>
<td>7.150000</td>
<td>14.750000</td>
<td>10.0</td>
</tr>
<tr>
<td>2</td>
<td>C</td>
<td>northbound</td>
<td>30.0</td>
<td>26.966667</td>
<td>-3.033333</td>
<td>-0.183333</td>
<td>10.0</td>
</tr>
<tr>
<td>3</td>
<td>C</td>
<td>northbound</td>
<td>40.0</td>
<td>35.516667</td>
<td>-4.483333</td>
<td>8.550000</td>
<td>10.0</td>
</tr>
<tr>
<td>4</td>
<td>C</td>
<td>northbound</td>
<td>50.0</td>
<td>53.583333</td>
<td>3.583333</td>
<td>18.066667</td>
<td>10.0</td>
</tr>
</tbody>
</table>
</div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&#34;C&#34;</span><span class="p">,</span> <span class="s2">&#34;D&#34;</span><span class="p">,</span> <span class="s2">&#34;E&#34;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">sequenced</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;route == &#39;</span><span class="si">{</span><span class="n">route</span><span class="si">}</span><span class="s2">&#39;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="s2">&#34;direction&#34;</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&#34;scheduled_interval&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">,</span> <span class="s2">&#34;actual_interval&#34;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="o">.</span><span class="n">set_titles</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">{row_name}</span><span class="s2"> (</span><span class="si">{col_name:.0f}</span><span class="s2"> mins)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="o">.</span><span class="n">set_axis_labels</span><span class="p">(</span><span class="s2">&#34;Actual interval (min)&#34;</span><span class="p">,</span> <span class="s2">&#34;Number of buses&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">route</span><span class="si">}</span><span class="s2"> line&#34;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="waiting-time-paradox_files/figure-markdown_strict/cell-17-output-1.png"
        data-srcset="waiting-time-paradox_files/figure-markdown_strict/cell-17-output-1.png, waiting-time-paradox_files/figure-markdown_strict/cell-17-output-1.png 1.5x, waiting-time-paradox_files/figure-markdown_strict/cell-17-output-1.png 2x"
        data-sizes="auto"
        alt="waiting-time-paradox_files/figure-markdown_strict/cell-17-output-1.png"
        title="waiting-time-paradox_files/figure-markdown_strict/cell-17-output-1.png" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="waiting-time-paradox_files/figure-markdown_strict/cell-17-output-2.png"
        data-srcset="waiting-time-paradox_files/figure-markdown_strict/cell-17-output-2.png, waiting-time-paradox_files/figure-markdown_strict/cell-17-output-2.png 1.5x, waiting-time-paradox_files/figure-markdown_strict/cell-17-output-2.png 2x"
        data-sizes="auto"
        alt="waiting-time-paradox_files/figure-markdown_strict/cell-17-output-2.png"
        title="waiting-time-paradox_files/figure-markdown_strict/cell-17-output-2.png" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="waiting-time-paradox_files/figure-markdown_strict/cell-17-output-3.png"
        data-srcset="waiting-time-paradox_files/figure-markdown_strict/cell-17-output-3.png, waiting-time-paradox_files/figure-markdown_strict/cell-17-output-3.png 1.5x, waiting-time-paradox_files/figure-markdown_strict/cell-17-output-3.png 2x"
        data-sizes="auto"
        alt="waiting-time-paradox_files/figure-markdown_strict/cell-17-output-3.png"
        title="waiting-time-paradox_files/figure-markdown_strict/cell-17-output-3.png" /></p>
<p>It&rsquo;s very clear that arrival intervals do not follow an exponential distribution. Instead, they are almost perfectly normal and peak near the point of their scheduled interval time.</p>
<h2 id="simulate-waiting-times">Simulate waiting times</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">grouped</span> <span class="o">=</span> <span class="n">sequenced</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&#34;route&#34;</span><span class="p">,</span> <span class="s2">&#34;direction&#34;</span><span class="p">,</span> <span class="s2">&#34;scheduled_interval&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">sims</span> <span class="o">=</span> <span class="n">grouped</span><span class="p">[</span><span class="s2">&#34;actual&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">simulate_wait_times</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sims</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">times</span><span class="p">:</span> <span class="s2">&#34;</span><span class="si">{0:.1f}</span><span class="s2"> +/- </span><span class="si">{1:.1f}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">times</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">times</span><span class="o">.</span><span class="n">std</span><span class="p">()))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>route  direction   scheduled_interval
C      northbound  10.0                   24.8 +/- 150.5
                   15.0                    12.9 +/- 73.2
       southbound  10.0                      6.2 +/- 6.0
                   15.0                    10.2 +/- 49.5
D      northbound  10.0                      5.9 +/- 6.7
                   15.0                      7.9 +/- 5.3
       southbound  10.0                  238.6 +/- 303.8
                   15.0                  144.5 +/- 252.1
E      northbound  10.0                   27.4 +/- 113.0
                   15.0                      7.9 +/- 4.9
       southbound  10.0                   82.6 +/- 199.6
                   15.0                   54.0 +/- 184.5
Name: actual, dtype: object
</code></pre>
<h2 id="unsolved-issues">Unsolved issues</h2>
<ol>
<li>
<p>As indicated above, I still can&rsquo;t see how jvdp gets to $p(T) = \frac{1}{\tau}e^{-T/\tau}$ for the distribution of intervals. Leaving this for now.</p>
</li>
<li>
<p>There is a problem in the code when I include 12 minute intervals. The output below shows len(arrival_times) and max(i) for each subset of the data. For some myserious reason, C northbound 12 mins interval have a customer for which the next bus is 1234, which is the bus after the last bus, which is not possible. I can&rsquo;t figure out how this comes about. So &ndash; after trying to figure this out for an hour now &ndash; I&rsquo;m gonna leave it for now.</p>
</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">grouped</span> <span class="o">=</span> <span class="n">sequenced</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&#34;route&#34;</span><span class="p">,</span> <span class="s2">&#34;direction&#34;</span><span class="p">,</span> <span class="s2">&#34;scheduled_interval&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">grouped</span><span class="p">[</span><span class="s2">&#34;actual&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">simulate_wait_times</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>route  direction   scheduled_interval
C      northbound  10.0                    (349, 348)
                   12.0                  (1434, 1434)
                   15.0                  (1377, 1376)
       southbound  10.0                    (483, 482)
                   12.0                  (1312, 1311)
                   15.0                  (1453, 1452)
D      northbound  10.0                    (441, 440)
                   12.0                  (1413, 1412)
                   15.0                  (1507, 1506)
       southbound  10.0                    (395, 394)
                   12.0                  (1300, 1299)
                   15.0                  (1391, 1390)
E      northbound  10.0                  (1869, 1868)
                   12.0                    (516, 515)
                   15.0                    (590, 589)
       southbound  10.0                  (1342, 1341)
                   12.0                  (1087, 1086)
                   15.0                  (1049, 1048)
Name: actual, dtype: object
</code></pre>
<h2 id="cool-stuff-picked-up-while-working-through-this">Cool stuff picked up while working through this</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Simulate arrivals and compare interval distribution to an exponential distribution</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">N</span> <span class="o">=</span> <span class="mi">1000000</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">diffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">N</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">diffs</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">expon</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="s2">&#34;-k&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="waiting-time-paradox_files/figure-markdown_strict/cell-20-output-1.png"
        data-srcset="waiting-time-paradox_files/figure-markdown_strict/cell-20-output-1.png, waiting-time-paradox_files/figure-markdown_strict/cell-20-output-1.png 1.5x, waiting-time-paradox_files/figure-markdown_strict/cell-20-output-1.png 2x"
        data-sizes="auto"
        alt="waiting-time-paradox_files/figure-markdown_strict/cell-20-output-1.png"
        title="waiting-time-paradox_files/figure-markdown_strict/cell-20-output-1.png" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Playing around with poisson and visualising normal approximation to poisson</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">poisson</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">l</span><span class="p">),</span> <span class="s2">&#34;-o&#34;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&#34;Lambda = </span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">end</span> <span class="o">=</span> <span class="mi">30</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">poisson</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">l</span><span class="p">),</span> <span class="s2">&#34;-o&#34;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&#34;Lambda =</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">end</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&#34;b&#34;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="waiting-time-paradox_files/figure-markdown_strict/cell-21-output-1.png"
        data-srcset="waiting-time-paradox_files/figure-markdown_strict/cell-21-output-1.png, waiting-time-paradox_files/figure-markdown_strict/cell-21-output-1.png 1.5x, waiting-time-paradox_files/figure-markdown_strict/cell-21-output-1.png 2x"
        data-sizes="auto"
        alt="waiting-time-paradox_files/figure-markdown_strict/cell-21-output-1.png"
        title="waiting-time-paradox_files/figure-markdown_strict/cell-21-output-1.png" /></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2023-10-02</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/datascience/">datascience</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/naive-bayes/" class="prev" rel="prev" title="Naive Bayes"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Naive Bayes</a>
            <a href="/seattle-bicycle-traffic/" class="next" rel="next" title="Seattle bicycle traffic">Seattle bicycle traffic<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.111.3">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2019 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank"></a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
