<!DOCTYPE html>
<html lang="en_gb">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Pandas cookbook - Fabian Gunzinger</title><meta name="Description" content=""><meta property="og:url" content="http://example.org/pandas-cookbook/">
  <meta property="og:site_name" content="Fabian Gunzinger">
  <meta property="og:title" content="Pandas cookbook">
  <meta property="og:description" content="A collection of recipes for effectively solving common and not so common problems in Pandas.
1 2 3 import numpy as np import pandas as pd import seaborn as sns Splitting dataframes based on column values You want to split the dataframe every time case equals B and store the resulting dataframes in a list.">
  <meta property="og:locale" content="en_gb">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-08-09T00:00:00+00:00">
    <meta property="article:modified_time" content="2023-10-02T08:42:30+01:00">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Pandas cookbook">
  <meta name="twitter:description" content="A collection of recipes for effectively solving common and not so common problems in Pandas.
1 2 3 import numpy as np import pandas as pd import seaborn as sns Splitting dataframes based on column values You want to split the dataframe every time case equals B and store the resulting dataframes in a list.">
<meta name="application-name" content="Fabian Gunzinger">
<meta name="apple-mobile-web-app-title" content="Fabian Gunzinger"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://example.org/pandas-cookbook/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Pandas cookbook",
        "inLanguage": "en_gb",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/example.org\/pandas-cookbook\/"
        },"genre": "posts","keywords": "python","wordcount":  3406 ,
        "url": "http:\/\/example.org\/pandas-cookbook\/","datePublished": "2020-08-09T00:00:00+00:00","dateModified": "2023-10-02T08:42:30+01:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Author"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Fabian Gunzinger"></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/"> Home </a><a class="menu-item" href="/research/"> Research </a><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Fabian Gunzinger"></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/" title="">Home</a><a class="menu-item" href="/research/" title="">Research</a><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Pandas cookbook</h1><div class="post-meta">
            <div class="post-meta-line"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Author</a></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2020-08-09">2020-08-09</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;3406 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;16 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="true">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#splitting-dataframes-based-on-column-values">Splitting dataframes based on column values</a>
      <ul>
        <li><a href="#understanding-the-cookbook-solution">Understanding the cookbook solution</a></li>
        <li><a href="#simplifying-the-code">Simplifying the code</a></li>
      </ul>
    </li>
    <li><a href="#creating-new-columns-based-on-existing-ones-using-mappings">Creating new columns based on existing ones using mappings</a></li>
    <li><a href="#creating-dummy-variables">Creating dummy variables</a></li>
    <li><a href="#pivot-tables">Pivot tables</a></li>
    <li><a href="#counting-number-of-equal-adjacent-values">Counting number of equal adjacent values</a></li>
    <li><a href="#reset-cumsum-at-each-missing-value">Reset <code>cumsum()</code> at each missing value</a></li>
    <li><a href="#apply">Apply</a>
      <ul>
        <li><a href="#using-apply-with-groupby">Using apply with groupby</a></li>
        <li><a href="#expanding-apply">Expanding apply</a></li>
        <li><a href="#sort-by-sum-of-group-values">Sort by sum of group values</a></li>
        <li><a href="#get-observation-with-largest-data-entry-for-each-group">Get observation with largest data entry for each group</a></li>
        <li><a href="#expanding-group-operations">Expanding group operations</a></li>
        <li><a href="#get-observation-with-largest-data-entry-for-each-group-1">Get observation with largest data entry for each group</a></li>
        <li><a href="#creating-separate-dataframe-for-each-group">Creating separate dataframe for each group</a></li>
      </ul>
    </li>
    <li><a href="#aggregating">Aggregating</a></li>
    <li><a href="#count-days-since-last-occurrence-of-event">Count days since last occurrence of event</a></li>
    <li><a href="#sources">Sources</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous" data-relocate-top="true"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<p>A collection of recipes for effectively solving common and not so common problems in Pandas.</p>
<!-- This post is part of my series of posts on [`pandas`](https://pandas.pydata.org). -->
<!-- [Fluent Pandas](http://localhost:8888/lab/tree/_notebooks/2021-03-12-fluent-pandas.ipynb) contains notes on how to effectively use pandas core features.

[Fast pandas](http://localhost:8888/lab/tree/_notebooks/0000-09-03-fast-pandas.ipynb) contains notes on how to effectively work with large datasets.

[Pandas cookbook](http://localhost:8888/lab/tree/_notebooks/2020-08-09-pandas-cookbook.ipynb) is a list of recipes for effectively solving common and not so common problems. -->
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="splitting-dataframes-based-on-column-values">Splitting dataframes based on column values</h2>
<p>You want to split the dataframe every time case equals B and store the resulting dataframes in a list.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;case&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;A&#34;</span><span class="p">,</span> <span class="s2">&#34;A&#34;</span><span class="p">,</span> <span class="s2">&#34;A&#34;</span><span class="p">,</span> <span class="s2">&#34;B&#34;</span><span class="p">,</span> <span class="s2">&#34;A&#34;</span><span class="p">,</span> <span class="s2">&#34;A&#34;</span><span class="p">,</span> <span class="s2">&#34;B&#34;</span><span class="p">,</span> <span class="s2">&#34;A&#34;</span><span class="p">,</span> <span class="s2">&#34;A&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;data&#34;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>case</th>
          <th>data</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>A</td>
          <td>0.064975</td>
      </tr>
      <tr>
          <td>1</td>
          <td>A</td>
          <td>-0.486814</td>
      </tr>
      <tr>
          <td>2</td>
          <td>A</td>
          <td>0.411896</td>
      </tr>
      <tr>
          <td>3</td>
          <td>B</td>
          <td>-1.397003</td>
      </tr>
      <tr>
          <td>4</td>
          <td>A</td>
          <td>1.148971</td>
      </tr>
      <tr>
          <td>5</td>
          <td>A</td>
          <td>0.817843</td>
      </tr>
      <tr>
          <td>6</td>
          <td>B</td>
          <td>-0.993385</td>
      </tr>
      <tr>
          <td>7</td>
          <td>A</td>
          <td>1.143321</td>
      </tr>
      <tr>
          <td>8</td>
          <td>A</td>
          <td>-0.134907</td>
      </tr>
  </tbody>
</table>
</div>
<h3 id="understanding-the-cookbook-solution">Understanding the cookbook solution</h3>
<p>From the <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/cookbook.html#id2" target="_blank" rel="noopener noreffer ">cookbook</a>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">dfs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nb">zip</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="o">*</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;case&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;B&#34;</span><span class="p">))</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">dfs</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>(  case      data
 0    A -0.900566
 1    A -1.127128
 2    A  0.342823
 3    B -0.854102,
   case      data
 4    A  1.058840
 5    A -0.307737
 6    B  0.013741,
   case      data
 7    A -1.768852
 8    A  0.550569)
</code></pre>
<p>This works. But because it&rsquo;s so heavily nested and uses methods like <code>rolling()</code> and <code>median()</code> not really designed for that purpose, the code is impossible to interpret at a glance.</p>
<p>Let&rsquo;s break this down into separate pieces.</p>
<p>First, the code creates a grouping variable that changes its value each time <em>case</em> equaled <em>B</em> on the previous row.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Creating grouping variable</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="k">case</span> <span class="o">==</span> <span class="s2">&#34;B&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="k">case</span> <span class="o">==</span> <span class="s2">&#34;B&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="k">case</span> <span class="o">==</span> <span class="s2">&#34;B&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="k">case</span> <span class="o">==</span> <span class="s2">&#34;B&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>(0    False
 1    False
 2    False
 3     True
 4    False
 5    False
 6     True
 7    False
 8    False
 Name: case, dtype: bool,
 0    0
 1    0
 2    0
 3    1
 4    0
 5    0
 6    1
 7    0
 8    0
 Name: case, dtype: int64,
 0    0
 1    0
 2    0
 3    1
 4    1
 5    1
 6    2
 7    2
 8    2
 Name: case, dtype: int64,
 0    0.0
 1    0.0
 2    0.0
 3    0.0
 4    1.0
 5    1.0
 6    1.0
 7    2.0
 8    2.0
 Name: case, dtype: float64)
</code></pre>
<p>Series <em>d</em> above is the argument passed to <code>groupby()</code> in the solution. This works, but is a very roundabout way to create such a series. I&rsquo;ll use a different approach below.</p>
<p>Next, the code uses <code>list()</code>, <code>zip()</code>, and argument expansion to pack the data for each group into a single list of dataframes. Let&rsquo;s look at these one by one.</p>
<p>First, <code>groupby()</code> stores the grouped data as <em>(label, df)</em> tuples.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">groups</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&#34;case&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&#34;</span><span class="se">\n\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>&lt;class 'tuple'&gt;
('A',   case      data
0    A -0.900566
1    A -1.127128
2    A  0.342823
4    A  1.058840
5    A -0.307737
7    A -1.768852
8    A  0.550569)

&lt;class 'tuple'&gt;
('B',   case      data
3    B -0.854102
6    B  0.013741)
</code></pre>
<p>Simplified, this is what we work with:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">groups2</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&#34;g1&#34;</span><span class="p">,</span> <span class="s2">&#34;data1&#34;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&#34;g2&#34;</span><span class="p">,</span> <span class="s2">&#34;data2&#34;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">groups2</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>[('g1', 'data1'), ('g2', 'data2')]
</code></pre>
<p><a href="https://docs.python.org/3/tutorial/controlflow.html#unpacking-argument-lists" target="_blank" rel="noopener noreffer ">Argument expansion</a> unpacks elements from a list as separate arguments that can be passed to a function. In our context here, it turns each <em>(label, df)</em> tuple into a separate object.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">groups2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="n">groups2</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>[('g1', 'data1'), ('g2', 'data2')]
('g1', 'data1') ('g2', 'data2')
</code></pre>
<p><code>zip()</code> stitches together the ith elements of each iterable passed to it, effectively separating the &ldquo;columns&rdquo;, and returns an iterator.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">groups2</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>&lt;zip at 0x16b1d3c80&gt;
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">groups2</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>[('g1', 'g2'), ('data1', 'data2')]
</code></pre>
<p>Putting this all together, <code>zip()</code> is used to separate the group label from the data, and <code>list()</code> consumes the iterator created by zip and displays its content.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">groups</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>[('A', 'B'),
 (  case      data
  0    A -0.900566
  1    A -1.127128
  2    A  0.342823
  4    A  1.058840
  5    A -0.307737
  7    A -1.768852
  8    A  0.550569,
    case      data
  3    B -0.854102
  6    B  0.013741)]
</code></pre>
<p>Because we only want the data, we select the last element from the list:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">groups</span><span class="p">))[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>(  case      data
 0    A  0.684978
 1    A  0.000269
 2    A -1.040497
 4    A  0.448596
 5    A  0.222168
 7    A -2.208787
 8    A -0.440758,
   case      data
 3    B  0.451358
 6    B  1.031011)
</code></pre>
<p>Now we&rsquo;re basically done. What remains is to use the <code>list(zip(*groups))</code> procedure on the more complicated grouping variable, to obtain the original result.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">d</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="k">case</span> <span class="o">==</span> <span class="s2">&#34;B&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">groups</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">groups</span><span class="p">))[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>(  case      data
 0    A  0.684978
 1    A  0.000269
 2    A -1.040497
 3    B  0.451358,
   case      data
 4    A  0.448596
 5    A  0.222168
 6    B  1.031011,
   case      data
 7    A -2.208787
 8    A -0.440758)
</code></pre>
<h3 id="simplifying-the-code">Simplifying the code</h3>
<p>I think this can be made much more readable like so:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>case</th>
          <th>data</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>A</td>
          <td>0.064975</td>
      </tr>
      <tr>
          <td>1</td>
          <td>A</td>
          <td>-0.486814</td>
      </tr>
      <tr>
          <td>2</td>
          <td>A</td>
          <td>0.411896</td>
      </tr>
      <tr>
          <td>3</td>
          <td>B</td>
          <td>-1.397003</td>
      </tr>
      <tr>
          <td>4</td>
          <td>A</td>
          <td>1.148971</td>
      </tr>
      <tr>
          <td>5</td>
          <td>A</td>
          <td>0.817843</td>
      </tr>
      <tr>
          <td>6</td>
          <td>B</td>
          <td>-0.993385</td>
      </tr>
      <tr>
          <td>7</td>
          <td>A</td>
          <td>1.143321</td>
      </tr>
      <tr>
          <td>8</td>
          <td>A</td>
          <td>-0.134907</td>
      </tr>
  </tbody>
</table>
</div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">grouper</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="k">case</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">frames</span> <span class="o">=</span> <span class="p">[</span><span class="n">df</span> <span class="k">for</span> <span class="n">g</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">grouper</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">frames</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>[  case      data
 0    A  0.064975
 1    A -0.486814
 2    A  0.411896
 3    B -1.397003,
   case      data
 4    A  1.148971
 5    A  0.817843
 6    B -0.993385,
   case      data
 7    A  1.143321
 8    A -0.134907]
</code></pre>
<p>Where the grouper works like so:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">dd</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&#34;case&#34;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Use case as index for clarity</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="k">case</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="s2">&#34;B&#34;</span><span class="p">)</span>  <span class="c1"># Boolean logic</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>  <span class="c1"># Create groups</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Shift so B included in previous group and fills missings with 0</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>(case
 A    False
 A    False
 A    False
 B     True
 A    False
 A    False
 B     True
 A    False
 A    False
 Name: case, dtype: bool,
 case
 A    0
 A    0
 A    0
 B    1
 A    1
 A    1
 B    2
 A    2
 A    2
 Name: case, dtype: int64,
 case
 A    0
 A    0
 A    0
 B    0
 A    1
 A    1
 B    1
 A    2
 A    2
 Name: case, dtype: int64)
</code></pre>
<h2 id="creating-new-columns-based-on-existing-ones-using-mappings">Creating new columns based on existing ones using mappings</h2>
<p>The below is a straightforward adaptation from the <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/cookbook.html#new-columns" target="_blank" rel="noopener noreffer ">cookbook</a>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&#34;AAA&#34;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">&#34;BBB&#34;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s2">&#34;CCC&#34;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">source_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;AAA&#34;</span><span class="p">,</span> <span class="s2">&#34;BBB&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">new_cols</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34;_cat&#34;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">source_cols</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">cats</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s2">&#34;One&#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s2">&#34;Two&#34;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s2">&#34;Three&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dd</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">dd</span><span class="p">[</span><span class="n">new_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">source_cols</span><span class="p">]</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="n">cats</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">dd</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>AAA</th>
          <th>BBB</th>
          <th>CCC</th>
          <th>AAA_cat</th>
          <th>BBB_cat</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>1</td>
          <td>1</td>
          <td>2</td>
          <td>One</td>
          <td>One</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2</td>
          <td>1</td>
          <td>1</td>
          <td>Two</td>
          <td>One</td>
      </tr>
      <tr>
          <td>2</td>
          <td>1</td>
          <td>4</td>
          <td>3</td>
          <td>One</td>
          <td>None</td>
      </tr>
      <tr>
          <td>3</td>
          <td>3</td>
          <td>2</td>
          <td>1</td>
          <td>Three</td>
          <td>Two</td>
      </tr>
  </tbody>
</table>
</div>
<p>But it made me wonder why applymap required the use of the get method while we can map values of a series like so:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>0      One
1      Two
2    Three
3      One
dtype: object
</code></pre>
<p>or so</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">s</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">cats</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>0      One
1      Two
2    Three
3      One
dtype: object
</code></pre>
<p>The answer is simple: applymap requires a function as argument, while map takes functions or mappings.</p>
<p>One limitation of the cookbook solution above is that is doesn&rsquo;t seem to allow for default values (notice that 4 gets substituted with &ldquo;None&rdquo;).</p>
<p>One way around this is the following:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>AAA</th>
          <th>BBB</th>
          <th>CCC</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>1</td>
          <td>1</td>
          <td>2</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2</td>
          <td>1</td>
          <td>1</td>
      </tr>
      <tr>
          <td>2</td>
          <td>1</td>
          <td>4</td>
          <td>3</td>
      </tr>
      <tr>
          <td>3</td>
          <td>3</td>
          <td>2</td>
          <td>1</td>
      </tr>
  </tbody>
</table>
</div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">dd</span><span class="p">[</span><span class="n">new_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="n">source_cols</span><span class="p">]</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">cats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&#34;Hello&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">dd</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>AAA</th>
          <th>BBB</th>
          <th>CCC</th>
          <th>AAA_cat</th>
          <th>BBB_cat</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>1</td>
          <td>1</td>
          <td>2</td>
          <td>One</td>
          <td>One</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2</td>
          <td>1</td>
          <td>1</td>
          <td>Two</td>
          <td>One</td>
      </tr>
      <tr>
          <td>2</td>
          <td>1</td>
          <td>4</td>
          <td>3</td>
          <td>One</td>
          <td>Hello</td>
      </tr>
      <tr>
          <td>3</td>
          <td>3</td>
          <td>2</td>
          <td>1</td>
          <td>Three</td>
          <td>Two</td>
      </tr>
  </tbody>
</table>
</div>
<h2 id="creating-dummy-variables">Creating dummy variables</h2>
<p>A reminder to my future self, based on <a href="https://www.youtube.com/watch?v=0s_1IsROgDc&amp;list=PL5-da3qGB5ICCsgW1MxlZ0Hq8LL5U3u9y&amp;index=24" target="_blank" rel="noopener noreffer ">this</a> great video from Data School.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;quality&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;good&#34;</span><span class="p">,</span> <span class="s2">&#34;excellent&#34;</span><span class="p">,</span> <span class="s2">&#34;very good&#34;</span><span class="p">,</span> <span class="s2">&#34;excellent&#34;</span><span class="p">,</span> <span class="s2">&#34;good&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>id</th>
          <th>quality</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>1</td>
          <td>good</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2</td>
          <td>excellent</td>
      </tr>
      <tr>
          <td>2</td>
          <td>3</td>
          <td>very good</td>
      </tr>
      <tr>
          <td>3</td>
          <td>4</td>
          <td>excellent</td>
      </tr>
      <tr>
          <td>4</td>
          <td>5</td>
          <td>good</td>
      </tr>
  </tbody>
</table>
</div>
<p>Pandas makes creating dummies easy:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">quality</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>excellent</th>
          <th>good</th>
          <th>very good</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>0</td>
          <td>1</td>
          <td>0</td>
      </tr>
      <tr>
          <td>1</td>
          <td>1</td>
          <td>0</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2</td>
          <td>0</td>
          <td>0</td>
          <td>1</td>
      </tr>
      <tr>
          <td>3</td>
          <td>1</td>
          <td>0</td>
          <td>0</td>
      </tr>
      <tr>
          <td>4</td>
          <td>0</td>
          <td>1</td>
          <td>0</td>
      </tr>
  </tbody>
</table>
</div>
<p>If you want to label the source of the data, you can use the prefix argument:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">quality</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&#34;quality&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>quality_excellent</th>
          <th>quality_good</th>
          <th>quality_very good</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>0</td>
          <td>1</td>
          <td>0</td>
      </tr>
      <tr>
          <td>1</td>
          <td>1</td>
          <td>0</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2</td>
          <td>0</td>
          <td>0</td>
          <td>1</td>
      </tr>
      <tr>
          <td>3</td>
          <td>1</td>
          <td>0</td>
          <td>0</td>
      </tr>
      <tr>
          <td>4</td>
          <td>0</td>
          <td>1</td>
          <td>0</td>
      </tr>
  </tbody>
</table>
</div>
<p>Often when we work with dummies from a variable with $n$ distinct values, we create $n-1$ dummies and treat the remaining group as the reference group. Pandas provides a convenient way to do this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">quality</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&#34;quality&#34;</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>quality_good</th>
          <th>quality_very good</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>1</td>
          <td>0</td>
      </tr>
      <tr>
          <td>1</td>
          <td>0</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2</td>
          <td>0</td>
          <td>1</td>
      </tr>
      <tr>
          <td>3</td>
          <td>0</td>
          <td>0</td>
      </tr>
      <tr>
          <td>4</td>
          <td>1</td>
          <td>0</td>
      </tr>
  </tbody>
</table>
</div>
<p>Usually, we&rsquo;ll want to use the dummies with the rest of the data, so it&rsquo;s conveninet to have them in the original dataframe. One way to do this is to use concat like so:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">dummies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">quality</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&#34;quality&#34;</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_with_dummies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">dummies</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_with_dummies</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>id</th>
          <th>quality</th>
          <th>quality_good</th>
          <th>quality_very good</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>1</td>
          <td>good</td>
          <td>1</td>
          <td>0</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2</td>
          <td>excellent</td>
          <td>0</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2</td>
          <td>3</td>
          <td>very good</td>
          <td>0</td>
          <td>1</td>
      </tr>
      <tr>
          <td>3</td>
          <td>4</td>
          <td>excellent</td>
          <td>0</td>
          <td>0</td>
      </tr>
      <tr>
          <td>4</td>
          <td>5</td>
          <td>good</td>
          <td>1</td>
          <td>0</td>
      </tr>
  </tbody>
</table>
</div>
<p>This works. But Pandas provides a much easier way:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_with_dummies1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;quality&#34;</span><span class="p">],</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_with_dummies1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>id</th>
          <th>quality_good</th>
          <th>quality_very good</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>1</td>
          <td>1</td>
          <td>0</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2</td>
          <td>0</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2</td>
          <td>3</td>
          <td>0</td>
          <td>1</td>
      </tr>
      <tr>
          <td>3</td>
          <td>4</td>
          <td>0</td>
          <td>0</td>
      </tr>
      <tr>
          <td>4</td>
          <td>5</td>
          <td>1</td>
          <td>0</td>
      </tr>
  </tbody>
</table>
</div>
<p>That&rsquo;s it. In one line we get a new dataframe that includes the dummies and excludes the original quality column.</p>
<h2 id="pivot-tables">Pivot tables</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s2">&#34;planets&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>(1035, 6)
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>method</th>
          <th>number</th>
          <th>orbital_period</th>
          <th>mass</th>
          <th>distance</th>
          <th>year</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>Radial Velocity</td>
          <td>1</td>
          <td>269.300</td>
          <td>7.10</td>
          <td>77.40</td>
          <td>2006</td>
      </tr>
      <tr>
          <td>1</td>
          <td>Radial Velocity</td>
          <td>1</td>
          <td>874.774</td>
          <td>2.21</td>
          <td>56.95</td>
          <td>2008</td>
      </tr>
      <tr>
          <td>2</td>
          <td>Radial Velocity</td>
          <td>1</td>
          <td>763.000</td>
          <td>2.60</td>
          <td>19.84</td>
          <td>2011</td>
      </tr>
  </tbody>
</table>
</div>
<p>Create a table that shows the number of planets discovered by each method in each decade</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Using groupby</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">decade</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;0s&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">decade</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;decade&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="n">decade</span><span class="p">])</span><span class="o">.</span><span class="n">number</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th>decade</th>
          <th>1980s</th>
          <th>1990s</th>
          <th>2000s</th>
          <th>2010s</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>method</td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>Astrometry</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>2</td>
      </tr>
      <tr>
          <td>Eclipse Timing Variations</td>
          <td>0</td>
          <td>0</td>
          <td>5</td>
          <td>10</td>
      </tr>
      <tr>
          <td>Imaging</td>
          <td>0</td>
          <td>0</td>
          <td>29</td>
          <td>21</td>
      </tr>
      <tr>
          <td>Microlensing</td>
          <td>0</td>
          <td>0</td>
          <td>12</td>
          <td>15</td>
      </tr>
      <tr>
          <td>Orbital Brightness Modulation</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>5</td>
      </tr>
      <tr>
          <td>Pulsar Timing</td>
          <td>0</td>
          <td>9</td>
          <td>1</td>
          <td>1</td>
      </tr>
      <tr>
          <td>Pulsation Timing Variations</td>
          <td>0</td>
          <td>0</td>
          <td>1</td>
          <td>0</td>
      </tr>
      <tr>
          <td>Radial Velocity</td>
          <td>1</td>
          <td>52</td>
          <td>475</td>
          <td>424</td>
      </tr>
      <tr>
          <td>Transit</td>
          <td>0</td>
          <td>0</td>
          <td>64</td>
          <td>712</td>
      </tr>
      <tr>
          <td>Transit Timing Variations</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>9</td>
      </tr>
  </tbody>
</table>
</div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Using pivot_table</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">decade</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;number&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th>decade</th>
          <th>1980s</th>
          <th>1990s</th>
          <th>2000s</th>
          <th>2010s</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>method</td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>Astrometry</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>2</td>
      </tr>
      <tr>
          <td>Eclipse Timing Variations</td>
          <td>0</td>
          <td>0</td>
          <td>5</td>
          <td>10</td>
      </tr>
      <tr>
          <td>Imaging</td>
          <td>0</td>
          <td>0</td>
          <td>29</td>
          <td>21</td>
      </tr>
      <tr>
          <td>Microlensing</td>
          <td>0</td>
          <td>0</td>
          <td>12</td>
          <td>15</td>
      </tr>
      <tr>
          <td>Orbital Brightness Modulation</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>5</td>
      </tr>
      <tr>
          <td>Pulsar Timing</td>
          <td>0</td>
          <td>9</td>
          <td>1</td>
          <td>1</td>
      </tr>
      <tr>
          <td>Pulsation Timing Variations</td>
          <td>0</td>
          <td>0</td>
          <td>1</td>
          <td>0</td>
      </tr>
      <tr>
          <td>Radial Velocity</td>
          <td>1</td>
          <td>52</td>
          <td>475</td>
          <td>424</td>
      </tr>
      <tr>
          <td>Transit</td>
          <td>0</td>
          <td>0</td>
          <td>64</td>
          <td>712</td>
      </tr>
      <tr>
          <td>Transit Timing Variations</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>9</td>
      </tr>
  </tbody>
</table>
</div>
<h2 id="counting-number-of-equal-adjacent-values">Counting number of equal adjacent values</h2>
<p>In the below column, cumulatively count the number of adjacent equal values.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;a&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>a</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>1</td>
      </tr>
      <tr>
          <td>1</td>
          <td>5</td>
      </tr>
      <tr>
          <td>2</td>
          <td>7</td>
      </tr>
      <tr>
          <td>3</td>
          <td>7</td>
      </tr>
      <tr>
          <td>4</td>
          <td>1</td>
      </tr>
      <tr>
          <td>5</td>
          <td>1</td>
      </tr>
      <tr>
          <td>6</td>
          <td>1</td>
      </tr>
      <tr>
          <td>7</td>
          <td>0</td>
      </tr>
  </tbody>
</table>
</div>
<p>Solution based on <a href="https://stackoverflow.com/a/29143354/13666841" target="_blank" rel="noopener noreffer ">this</a> Stack Overflow answer:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s2">&#34;count&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">a</span> <span class="o">!=</span> <span class="n">df</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">shift</span><span class="p">())</span><span class="o">.</span><span class="n">cumsum</span><span class="p">())</span><span class="o">.</span><span class="n">cumcount</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>a</th>
          <th>count</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>1</td>
          <td>1</td>
      </tr>
      <tr>
          <td>1</td>
          <td>5</td>
          <td>1</td>
      </tr>
      <tr>
          <td>2</td>
          <td>7</td>
          <td>1</td>
      </tr>
      <tr>
          <td>3</td>
          <td>7</td>
          <td>2</td>
      </tr>
      <tr>
          <td>4</td>
          <td>1</td>
          <td>1</td>
      </tr>
      <tr>
          <td>5</td>
          <td>1</td>
          <td>2</td>
      </tr>
      <tr>
          <td>6</td>
          <td>1</td>
          <td>3</td>
      </tr>
      <tr>
          <td>7</td>
          <td>0</td>
          <td>1</td>
      </tr>
  </tbody>
</table>
</div>
<h2 id="reset-cumsum-at-each-missing-value">Reset <code>cumsum()</code> at each missing value</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>0    1.0
1    3.0
2    1.0
3    NaN
4    1.0
5    1.0
6    1.0
7    1.0
8    NaN
9    1.0
dtype: float64
</code></pre>
<p>What I don&rsquo;t want:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">s</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>0     1.0
1     4.0
2     5.0
3     NaN
4     6.0
5     7.0
6     8.0
7     9.0
8     NaN
9    10.0
dtype: float64
</code></pre>
<p>Instead, I want to reset the counter to zero after each missing value. Solution from <a href="https://stackoverflow.com/a/36436195/13666841" target="_blank" rel="noopener noreffer ">this</a> SO answer.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cumsum</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span><span class="o">.</span><span class="n">ffill</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">reset</span> <span class="o">=</span> <span class="o">-</span><span class="n">cumsum</span><span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">cumsum</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">notna</span><span class="p">(),</span> <span class="n">reset</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>0    1.0
1    4.0
2    5.0
3    0.0
4    1.0
5    2.0
6    3.0
7    4.0
8    0.0
9    1.0
dtype: float64
</code></pre>
<h2 id="apply">Apply</h2>
<h3 id="using-apply-with-groupby">Using apply with groupby</h3>
<p>From the <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/cookbook.html#grouping" target="_blank" rel="noopener noreffer ">cookbook</a>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;animal&#34;</span><span class="p">:</span> <span class="s2">&#34;cat dog cat fish dog cat cat&#34;</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;size&#34;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="s2">&#34;SSMMMLL&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;weight&#34;</span><span class="p">:</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;adult&#34;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">+</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>animal</th>
          <th>size</th>
          <th>weight</th>
          <th>adult</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>cat</td>
          <td>S</td>
          <td>8</td>
          <td>False</td>
      </tr>
      <tr>
          <td>1</td>
          <td>dog</td>
          <td>S</td>
          <td>10</td>
          <td>False</td>
      </tr>
      <tr>
          <td>2</td>
          <td>cat</td>
          <td>M</td>
          <td>11</td>
          <td>False</td>
      </tr>
      <tr>
          <td>3</td>
          <td>fish</td>
          <td>M</td>
          <td>1</td>
          <td>False</td>
      </tr>
      <tr>
          <td>4</td>
          <td>dog</td>
          <td>M</td>
          <td>20</td>
          <td>False</td>
      </tr>
      <tr>
          <td>5</td>
          <td>cat</td>
          <td>L</td>
          <td>12</td>
          <td>True</td>
      </tr>
      <tr>
          <td>6</td>
          <td>cat</td>
          <td>L</td>
          <td>12</td>
          <td>True</td>
      </tr>
  </tbody>
</table>
</div>
<p>For each type of animal, return the size of the heaviest one</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;animal&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">g</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(),</span> <span class="s1">&#39;size&#39;</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>animal
cat     L
dog     M
fish    M
dtype: object
</code></pre>
<h3 id="expanding-apply">Expanding apply</h3>
<p>Assume you want to calculate the cumulative return from a series of one-period returns in an expanding fashion &ndash; in each period, you want the cumulative return up to that period.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">i</span> <span class="o">/</span> <span class="mf">100.0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>0    0.01
1    0.02
2    0.03
dtype: float64
</code></pre>
<p>The solution is given <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/cookbook.html#grouping" target="_blank" rel="noopener noreffer ">here</a>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">functools</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">cum_return</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">red</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">res</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">cum_return</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">res</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">s</span><span class="o">.</span><span class="n">expanding</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">red</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>0    1.010000
1    1.030200
2    1.061106
dtype: float64
</code></pre>
<p>I found that somewhere between bewildering and magical. To see what&rsquo;s going on, it helps to add a few print statements:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">functools</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">cum_return</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;x:&#34;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;y:&#34;</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">red</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Series:&#34;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">res</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">cum_return</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Result:&#34;</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">res</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">s</span><span class="o">.</span><span class="n">expanding</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">red</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>Series: [0.01]
x: 1
y: 0.01
Result: 1.01

Series: [0.01 0.02]
x: 1
y: 0.01
x: 1.01
y: 0.02
Result: 1.0302

Series: [0.01 0.02 0.03]
x: 1
y: 0.01
x: 1.01
y: 0.02
x: 1.0302
y: 0.03
Result: 1.061106

0    1.010000
1    1.030200
2    1.061106
dtype: float64
</code></pre>
<p>This makes transparent how reduce works: it takes the starting value (1 here) as the initial x value and the first value of the series as y value, and then returns the result of cum_returns. Next, it uses that result as x, and the second element in the series as y, and calculates the new result of cum_returns. This is then repeated until it has run through the entire series.</p>
<p>What surprised me is to see that reduce always starts the calculation from the beginning, rather than re-using the last calculated result. This seems inefficient, but is probably necessary for some reason.</p>
<h3 id="sort-by-sum-of-group-values">Sort by sum of group values</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;code&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;foo&#34;</span><span class="p">,</span> <span class="s2">&#34;bar&#34;</span><span class="p">,</span> <span class="s2">&#34;baz&#34;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.16</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.21</span><span class="p">,</span> <span class="mf">0.33</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.59</span><span class="p">,</span> <span class="mf">0.62</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;flag&#34;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>code</th>
          <th>data</th>
          <th>flag</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>foo</td>
          <td>0.16</td>
          <td>False</td>
      </tr>
      <tr>
          <td>1</td>
          <td>bar</td>
          <td>-0.21</td>
          <td>True</td>
      </tr>
      <tr>
          <td>2</td>
          <td>baz</td>
          <td>0.33</td>
          <td>False</td>
      </tr>
      <tr>
          <td>3</td>
          <td>foo</td>
          <td>0.45</td>
          <td>True</td>
      </tr>
      <tr>
          <td>4</td>
          <td>bar</td>
          <td>-0.59</td>
          <td>False</td>
      </tr>
      <tr>
          <td>5</td>
          <td>baz</td>
          <td>0.62</td>
          <td>True</td>
      </tr>
  </tbody>
</table>
</div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">g</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&#34;code&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sort_order</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="s2">&#34;data&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="nb">sum</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">index</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sort_order</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>code</th>
          <th>data</th>
          <th>flag</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>bar</td>
          <td>-0.21</td>
          <td>True</td>
      </tr>
      <tr>
          <td>4</td>
          <td>bar</td>
          <td>-0.59</td>
          <td>False</td>
      </tr>
      <tr>
          <td>0</td>
          <td>foo</td>
          <td>0.16</td>
          <td>False</td>
      </tr>
      <tr>
          <td>3</td>
          <td>foo</td>
          <td>0.45</td>
          <td>True</td>
      </tr>
      <tr>
          <td>2</td>
          <td>baz</td>
          <td>0.33</td>
          <td>False</td>
      </tr>
      <tr>
          <td>5</td>
          <td>baz</td>
          <td>0.62</td>
          <td>True</td>
      </tr>
  </tbody>
</table>
</div>
<h3 id="get-observation-with-largest-data-entry-for-each-group">Get observation with largest data entry for each group</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>code</th>
          <th>data</th>
          <th>flag</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>bar</td>
          <td>-0.21</td>
          <td>True</td>
      </tr>
      <tr>
          <td>5</td>
          <td>baz</td>
          <td>0.62</td>
          <td>True</td>
      </tr>
      <tr>
          <td>3</td>
          <td>foo</td>
          <td>0.45</td>
          <td>True</td>
      </tr>
  </tbody>
</table>
</div>
<h3 id="expanding-group-operations">Expanding group operations</h3>
<p>Based on <a href="https://stackoverflow.com/a/15489701/13666841" target="_blank" rel="noopener noreffer ">this</a> answer.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;code&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;foo&#34;</span><span class="p">,</span> <span class="s2">&#34;bar&#34;</span><span class="p">,</span> <span class="s2">&#34;baz&#34;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.16</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.21</span><span class="p">,</span> <span class="mf">0.33</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.59</span><span class="p">,</span> <span class="mf">0.62</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;flag&#34;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>code</th>
          <th>data</th>
          <th>flag</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>foo</td>
          <td>0.16</td>
          <td>False</td>
      </tr>
      <tr>
          <td>1</td>
          <td>bar</td>
          <td>-0.21</td>
          <td>True</td>
      </tr>
      <tr>
          <td>2</td>
          <td>baz</td>
          <td>0.33</td>
          <td>False</td>
      </tr>
      <tr>
          <td>3</td>
          <td>foo</td>
          <td>0.45</td>
          <td>True</td>
      </tr>
      <tr>
          <td>4</td>
          <td>bar</td>
          <td>-0.59</td>
          <td>False</td>
      </tr>
      <tr>
          <td>5</td>
          <td>baz</td>
          <td>0.62</td>
          <td>True</td>
      </tr>
      <tr>
          <td>6</td>
          <td>foo</td>
          <td>0.16</td>
          <td>False</td>
      </tr>
      <tr>
          <td>7</td>
          <td>bar</td>
          <td>-0.21</td>
          <td>True</td>
      </tr>
      <tr>
          <td>8</td>
          <td>baz</td>
          <td>0.33</td>
          <td>False</td>
      </tr>
      <tr>
          <td>9</td>
          <td>foo</td>
          <td>0.45</td>
          <td>True</td>
      </tr>
      <tr>
          <td>10</td>
          <td>bar</td>
          <td>-0.59</td>
          <td>False</td>
      </tr>
      <tr>
          <td>11</td>
          <td>baz</td>
          <td>0.62</td>
          <td>True</td>
      </tr>
  </tbody>
</table>
</div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">g</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&#34;code&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">helper</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">expanding</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="p">[</span><span class="s2">&#34;exp_mean&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="p">[</span><span class="s2">&#34;exp_sum&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="p">[</span><span class="s2">&#34;exp_count&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">g</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">helper</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&#34;code&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>code</th>
          <th>data</th>
          <th>flag</th>
          <th>exp_mean</th>
          <th>exp_sum</th>
          <th>exp_count</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>bar</td>
          <td>-0.21</td>
          <td>True</td>
          <td>-0.210000</td>
          <td>-0.21</td>
          <td>1.0</td>
      </tr>
      <tr>
          <td>4</td>
          <td>bar</td>
          <td>-0.59</td>
          <td>False</td>
          <td>-0.400000</td>
          <td>-0.80</td>
          <td>2.0</td>
      </tr>
      <tr>
          <td>7</td>
          <td>bar</td>
          <td>-0.21</td>
          <td>True</td>
          <td>-0.336667</td>
          <td>-1.01</td>
          <td>3.0</td>
      </tr>
      <tr>
          <td>10</td>
          <td>bar</td>
          <td>-0.59</td>
          <td>False</td>
          <td>-0.400000</td>
          <td>-1.60</td>
          <td>4.0</td>
      </tr>
      <tr>
          <td>2</td>
          <td>baz</td>
          <td>0.33</td>
          <td>False</td>
          <td>0.330000</td>
          <td>0.33</td>
          <td>1.0</td>
      </tr>
      <tr>
          <td>5</td>
          <td>baz</td>
          <td>0.62</td>
          <td>True</td>
          <td>0.475000</td>
          <td>0.95</td>
          <td>2.0</td>
      </tr>
      <tr>
          <td>8</td>
          <td>baz</td>
          <td>0.33</td>
          <td>False</td>
          <td>0.426667</td>
          <td>1.28</td>
          <td>3.0</td>
      </tr>
      <tr>
          <td>11</td>
          <td>baz</td>
          <td>0.62</td>
          <td>True</td>
          <td>0.475000</td>
          <td>1.90</td>
          <td>4.0</td>
      </tr>
      <tr>
          <td>0</td>
          <td>foo</td>
          <td>0.16</td>
          <td>False</td>
          <td>0.160000</td>
          <td>0.16</td>
          <td>1.0</td>
      </tr>
      <tr>
          <td>3</td>
          <td>foo</td>
          <td>0.45</td>
          <td>True</td>
          <td>0.305000</td>
          <td>0.61</td>
          <td>2.0</td>
      </tr>
      <tr>
          <td>6</td>
          <td>foo</td>
          <td>0.16</td>
          <td>False</td>
          <td>0.256667</td>
          <td>0.77</td>
          <td>3.0</td>
      </tr>
      <tr>
          <td>9</td>
          <td>foo</td>
          <td>0.45</td>
          <td>True</td>
          <td>0.305000</td>
          <td>1.22</td>
          <td>4.0</td>
      </tr>
  </tbody>
</table>
</div>
<h3 id="get-observation-with-largest-data-entry-for-each-group-1">Get observation with largest data entry for each group</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&#34;a&#34;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="s2">&#34;b&#34;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">],</span> <span class="s2">&#34;c&#34;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">50</span><span class="p">]})</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>a</th>
          <th>b</th>
          <th>c</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>4</td>
          <td>10</td>
          <td>100</td>
      </tr>
      <tr>
          <td>1</td>
          <td>5</td>
          <td>20</td>
          <td>50</td>
      </tr>
      <tr>
          <td>2</td>
          <td>6</td>
          <td>30</td>
          <td>-30</td>
      </tr>
      <tr>
          <td>3</td>
          <td>7</td>
          <td>40</td>
          <td>-50</td>
      </tr>
  </tbody>
</table>
</div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">myval</span> <span class="o">=</span> <span class="mi">34</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">c</span> <span class="o">-</span> <span class="n">myval</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">argsort</span><span class="p">()]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>a</th>
          <th>b</th>
          <th>c</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>5</td>
          <td>20</td>
          <td>50</td>
      </tr>
      <tr>
          <td>2</td>
          <td>6</td>
          <td>30</td>
          <td>-30</td>
      </tr>
      <tr>
          <td>0</td>
          <td>4</td>
          <td>10</td>
          <td>100</td>
      </tr>
      <tr>
          <td>3</td>
          <td>7</td>
          <td>40</td>
          <td>-50</td>
      </tr>
  </tbody>
</table>
</div>
<p>Reminder of what happens here:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">c</span> <span class="o">-</span> <span class="n">myval</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span><span class="p">,</span> <span class="n">b</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>(0    66
 1    16
 2    64
 3    84
 Name: c, dtype: int64,
 0    1
 1    2
 2    0
 3    3
 Name: c, dtype: int64)
</code></pre>
<p><code>argsort</code> returns a series of indexes, so that <code>df[b]</code> returns an ordered dataframe. The first element in <code>b</code> thus refers to the index of the smallest element in <code>a</code>.</p>
<h3 id="creating-separate-dataframe-for-each-group">Creating separate dataframe for each group</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s2">&#34;iris&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">pieces</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&#34;species&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="n">pieces</span><span class="p">[</span><span class="s2">&#34;setosa&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>sepal_length</th>
          <th>sepal_width</th>
          <th>petal_length</th>
          <th>petal_width</th>
          <th>species</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>5.1</td>
          <td>3.5</td>
          <td>1.4</td>
          <td>0.2</td>
          <td>setosa</td>
      </tr>
      <tr>
          <td>1</td>
          <td>4.9</td>
          <td>3.0</td>
          <td>1.4</td>
          <td>0.2</td>
          <td>setosa</td>
      </tr>
      <tr>
          <td>2</td>
          <td>4.7</td>
          <td>3.2</td>
          <td>1.3</td>
          <td>0.2</td>
          <td>setosa</td>
      </tr>
  </tbody>
</table>
</div>
<h2 id="aggregating">Aggregating</h2>
<p>From <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/cookbook.html#pivot" target="_blank" rel="noopener noreffer ">here</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;StudentID&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;x1&#34;</span><span class="p">,</span> <span class="s2">&#34;x10&#34;</span><span class="p">,</span> <span class="s2">&#34;x2&#34;</span><span class="p">,</span> <span class="s2">&#34;x3&#34;</span><span class="p">,</span> <span class="s2">&#34;x4&#34;</span><span class="p">,</span> <span class="s2">&#34;x5&#34;</span><span class="p">,</span> <span class="s2">&#34;x6&#34;</span><span class="p">,</span> <span class="s2">&#34;x7&#34;</span><span class="p">,</span> <span class="s2">&#34;x8&#34;</span><span class="p">,</span> <span class="s2">&#34;x9&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;StudentGender&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;F&#34;</span><span class="p">,</span> <span class="s2">&#34;M&#34;</span><span class="p">,</span> <span class="s2">&#34;F&#34;</span><span class="p">,</span> <span class="s2">&#34;M&#34;</span><span class="p">,</span> <span class="s2">&#34;F&#34;</span><span class="p">,</span> <span class="s2">&#34;M&#34;</span><span class="p">,</span> <span class="s2">&#34;F&#34;</span><span class="p">,</span> <span class="s2">&#34;M&#34;</span><span class="p">,</span> <span class="s2">&#34;M&#34;</span><span class="p">,</span> <span class="s2">&#34;M&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ExamYear&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;2007&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;2007&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;2007&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;2008&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;2008&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;2008&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;2008&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;2009&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;2009&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;2009&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Exam&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;algebra&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;stats&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;bio&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;algebra&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;algebra&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;stats&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;stats&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;algebra&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;bio&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;bio&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Participated&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;no&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;yes&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;yes&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;yes&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;no&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;yes&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;yes&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;yes&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;yes&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;yes&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Passed&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;no&#34;</span><span class="p">,</span> <span class="s2">&#34;yes&#34;</span><span class="p">,</span> <span class="s2">&#34;yes&#34;</span><span class="p">,</span> <span class="s2">&#34;yes&#34;</span><span class="p">,</span> <span class="s2">&#34;no&#34;</span><span class="p">,</span> <span class="s2">&#34;yes&#34;</span><span class="p">,</span> <span class="s2">&#34;yes&#34;</span><span class="p">,</span> <span class="s2">&#34;yes&#34;</span><span class="p">,</span> <span class="s2">&#34;no&#34;</span><span class="p">,</span> <span class="s2">&#34;yes&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;StudentID&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;StudentGender&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ExamYear&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Exam&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Participated&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Passed&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>studentid</th>
          <th>studentgender</th>
          <th>examyear</th>
          <th>exam</th>
          <th>participated</th>
          <th>passed</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>x1</td>
          <td>F</td>
          <td>2007</td>
          <td>algebra</td>
          <td>no</td>
          <td>no</td>
      </tr>
      <tr>
          <td>1</td>
          <td>x10</td>
          <td>M</td>
          <td>2007</td>
          <td>stats</td>
          <td>yes</td>
          <td>yes</td>
      </tr>
      <tr>
          <td>2</td>
          <td>x2</td>
          <td>F</td>
          <td>2007</td>
          <td>bio</td>
          <td>yes</td>
          <td>yes</td>
      </tr>
      <tr>
          <td>3</td>
          <td>x3</td>
          <td>M</td>
          <td>2008</td>
          <td>algebra</td>
          <td>yes</td>
          <td>yes</td>
      </tr>
      <tr>
          <td>4</td>
          <td>x4</td>
          <td>F</td>
          <td>2008</td>
          <td>algebra</td>
          <td>no</td>
          <td>no</td>
      </tr>
      <tr>
          <td>5</td>
          <td>x5</td>
          <td>M</td>
          <td>2008</td>
          <td>stats</td>
          <td>yes</td>
          <td>yes</td>
      </tr>
      <tr>
          <td>6</td>
          <td>x6</td>
          <td>F</td>
          <td>2008</td>
          <td>stats</td>
          <td>yes</td>
          <td>yes</td>
      </tr>
      <tr>
          <td>7</td>
          <td>x7</td>
          <td>M</td>
          <td>2009</td>
          <td>algebra</td>
          <td>yes</td>
          <td>yes</td>
      </tr>
      <tr>
          <td>8</td>
          <td>x8</td>
          <td>M</td>
          <td>2009</td>
          <td>bio</td>
          <td>yes</td>
          <td>no</td>
      </tr>
      <tr>
          <td>9</td>
          <td>x9</td>
          <td>M</td>
          <td>2009</td>
          <td>bio</td>
          <td>yes</td>
          <td>yes</td>
      </tr>
  </tbody>
</table>
</div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">numyes</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;examyear&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;participated&#39;</span><span class="p">:</span> <span class="n">numyes</span><span class="p">,</span> <span class="s1">&#39;passed&#39;</span><span class="p">:</span> <span class="n">numyes</span><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>participated</th>
          <th>passed</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>examyear</td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>2007</td>
          <td>2</td>
          <td>2</td>
      </tr>
      <tr>
          <td>2008</td>
          <td>3</td>
          <td>3</td>
      </tr>
      <tr>
          <td>2009</td>
          <td>3</td>
          <td>2</td>
      </tr>
  </tbody>
</table>
</div>
<h2 id="count-days-since-last-occurrence-of-event">Count days since last occurrence of event</h2>
<p>We want a count of the number of days passed since the last event happened.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;date&#34;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s2">&#34;1 Jan 2022&#34;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&#34;d&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;event&#34;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;result&#34;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>date</th>
          <th>event</th>
          <th>result</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>2022-01-01</td>
          <td>NaN</td>
          <td>NaN</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2022-01-02</td>
          <td>NaN</td>
          <td>NaN</td>
      </tr>
      <tr>
          <td>2</td>
          <td>2022-01-03</td>
          <td>1.0</td>
          <td>0.0</td>
      </tr>
      <tr>
          <td>3</td>
          <td>2022-01-04</td>
          <td>NaN</td>
          <td>1.0</td>
      </tr>
      <tr>
          <td>4</td>
          <td>2022-01-05</td>
          <td>NaN</td>
          <td>2.0</td>
      </tr>
      <tr>
          <td>5</td>
          <td>2022-01-06</td>
          <td>NaN</td>
          <td>3.0</td>
      </tr>
      <tr>
          <td>6</td>
          <td>2022-01-07</td>
          <td>4.0</td>
          <td>0.0</td>
      </tr>
      <tr>
          <td>7</td>
          <td>2022-01-08</td>
          <td>NaN</td>
          <td>1.0</td>
      </tr>
  </tbody>
</table>
</div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">add_days_since_event</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">ones</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">ffill</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cumsum</span> <span class="o">=</span> <span class="n">ones</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">reset</span> <span class="o">=</span> <span class="o">-</span><span class="n">cumsum</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">notna</span><span class="p">()]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">cumsum</span><span class="p">)</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">[</span><span class="s2">&#34;result&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ones</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span> <span class="n">reset</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">df</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">add_days_since_event</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>date</th>
          <th>event</th>
          <th>result</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>2022-01-01</td>
          <td>NaN</td>
          <td>NaN</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2022-01-02</td>
          <td>NaN</td>
          <td>NaN</td>
      </tr>
      <tr>
          <td>2</td>
          <td>2022-01-03</td>
          <td>1.0</td>
          <td>0.0</td>
      </tr>
      <tr>
          <td>3</td>
          <td>2022-01-04</td>
          <td>NaN</td>
          <td>1.0</td>
      </tr>
      <tr>
          <td>4</td>
          <td>2022-01-05</td>
          <td>NaN</td>
          <td>2.0</td>
      </tr>
      <tr>
          <td>5</td>
          <td>2022-01-06</td>
          <td>NaN</td>
          <td>3.0</td>
      </tr>
      <tr>
          <td>6</td>
          <td>2022-01-07</td>
          <td>4.0</td>
          <td>0.0</td>
      </tr>
      <tr>
          <td>7</td>
          <td>2022-01-08</td>
          <td>NaN</td>
          <td>1.0</td>
      </tr>
  </tbody>
</table>
</div>
<h2 id="sources">Sources</h2>
<ul>
<li><a href="https://www.oreilly.com/library/view/python-for-data/9781491957653/" target="_blank" rel="noopener noreffer ">Python for Data Analysis</a></li>
<li><a href="https://www.oreilly.com/library/view/python-data-science/9781491912126/" target="_blank" rel="noopener noreffer ">Python Data Science Handbook</a></li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/cookbook.html" target="_blank" rel="noopener noreffer ">Pandas cookbook</a></li>
<li><a href="https://www.youtube.com/watch?v=dPwLlJkSHLo" target="_blank" rel="noopener noreffer ">Data School - Data science best practice with Pandas</a></li>
</ul>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2023-10-02</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href=""></a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.147.8">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2019 - 2025</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank"></a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
