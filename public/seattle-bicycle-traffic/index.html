<!DOCTYPE html>
<html lang="en_gb">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Seattle bicycle traffic - Fabian Gunzinger</title><meta name="Description" content=""><meta property="og:title" content="Seattle bicycle traffic" />
<meta property="og:description" content="This notebook contains my replication of this blog post by Jake VanderPlas on using data from bicycle traffic across Seattle&rsquo;s Fremont Bridge to learn about commuting patterns.
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 import os import ssl from urllib.request import urlretrieve import altair as alt import matplotlib.pyplot as plt import numpy as np import pandas as pd import seaborn from pandas." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/seattle-bicycle-traffic/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-02-07T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-10-02T08:42:30+01:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Seattle bicycle traffic"/>
<meta name="twitter:description" content="This notebook contains my replication of this blog post by Jake VanderPlas on using data from bicycle traffic across Seattle&rsquo;s Fremont Bridge to learn about commuting patterns.
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 import os import ssl from urllib.request import urlretrieve import altair as alt import matplotlib.pyplot as plt import numpy as np import pandas as pd import seaborn from pandas."/>
<meta name="application-name" content="Fabian Gunzinger">
<meta name="apple-mobile-web-app-title" content="Fabian Gunzinger"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://example.org/seattle-bicycle-traffic/" /><link rel="prev" href="http://example.org/waiting-time-paradox/" /><link rel="next" href="http://example.org/aws/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Seattle bicycle traffic",
        "inLanguage": "en_gb",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/example.org\/seattle-bicycle-traffic\/"
        },"genre": "posts","keywords": "datascience","wordcount":  2768 ,
        "url": "http:\/\/example.org\/seattle-bicycle-traffic\/","datePublished": "2020-02-07T00:00:00+00:00","dateModified": "2023-10-02T08:42:30+01:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Author"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Fabian Gunzinger"></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/"> Home </a><a class="menu-item" href="/research/"> Research </a><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Fabian Gunzinger"></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/" title="">Home</a><a class="menu-item" href="/research/" title="">Research</a><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Seattle bicycle traffic</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Author</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2020-02-07">2020-02-07</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;2768 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;13 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="true">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#unsupervised-exploration">Unsupervised exploration</a>
      <ul>
        <li><a href="#visualising-the-data">Visualising the data</a></li>
        <li><a href="#unsupervised-clustering">Unsupervised clustering</a></li>
        <li><a href="#uncovering-work-habits">Uncovering work habits</a></li>
        <li><a href="#whats-up-with-fridays">What&rsquo;s up with Fridays?</a></li>
      </ul>
    </li>
    <li><a href="#supervised-modeling">Supervised modeling</a>
      <ul>
        <li><a href="#accounting-for-hours-of-daylight">Accounting for hours of daylight</a></li>
        <li><a href="#accounting-for-day-of-the-week">Accounting for day of the week</a></li>
        <li><a href="#accounting-for-rainfall-and-temparature">Accounting for rainfall and temparature</a></li>
        <li><a href="#accounting-for-a-steady-increase-in-riders">Accounting for a steady increase in riders</a></li>
        <li><a href="#what-can-the-final-model-tell-us">What can the final model tell us?</a>
          <ul>
            <li><a href="#how-does-rain-affect-ridership">How does rain affect ridership?</a></li>
            <li><a href="#how-does-temparature-affect-ridership">How does temparature affect ridership?</a></li>
            <li><a href="#how-does-daylight-affect-ridership">How does daylight affect ridership?</a></li>
            <li><a href="#is-ridership-increasing">Is ridership increasing?</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<p>This notebook contains my replication of <a href="https://jakevdp.github.io/blog/2015/07/23/learning-seattles-work-habits-from-bicycle-counts/" target="_blank" rel="noopener noreffer ">this</a> blog post by <a href="http://vanderplas.com/" target="_blank" rel="noopener noreffer ">Jake VanderPlas</a> on using data from bicycle traffic across Seattle&rsquo;s Fremont Bridge to learn about commuting patterns.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">ssl</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlretrieve</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">seaborn</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pandas.tseries.holiday</span> <span class="kn">import</span> <span class="n">USFederalHolidayCalendar</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">seattlecycling.data</span> <span class="kn">import</span> <span class="n">get_fremont_data</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">seattlecycling.toolbox</span> <span class="kn">import</span> <span class="n">csnap</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.mixture</span> <span class="kn">import</span> <span class="n">GaussianMixture</span> <span class="k">as</span> <span class="n">GMM</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span> <span class="k">as</span> <span class="n">vega_data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">seaborn</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Helper functions</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">fremont_url</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;https://data.seattle.gov/api/views/65db-xm6k/rows.csv?accessType=DOWNLOAD&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_fremont_data</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">filename</span><span class="o">=</span><span class="s2">&#34;seattle_weather_fremont.csv&#34;</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">fremont_url</span><span class="p">,</span> <span class="n">force_download</span><span class="o">=</span><span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Download and cache the fremont bridge data
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters
</span></span></span><span class="line"><span class="cl"><span class="s2">    ----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    filename : string (optional)
</span></span></span><span class="line"><span class="cl"><span class="s2">        location to store the data
</span></span></span><span class="line"><span class="cl"><span class="s2">    url : string (optional)
</span></span></span><span class="line"><span class="cl"><span class="s2">        web location of the data
</span></span></span><span class="line"><span class="cl"><span class="s2">    force_download : Boolean (optional)
</span></span></span><span class="line"><span class="cl"><span class="s2">        if True, force redownload of data
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns
</span></span></span><span class="line"><span class="cl"><span class="s2">    -------
</span></span></span><span class="line"><span class="cl"><span class="s2">    data : pandas.DataFrame
</span></span></span><span class="line"><span class="cl"><span class="s2">        The fremont bridge data
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Solve problem with SSL certificate verification</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;PYTHONHTTPSVERIFY&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">ssl</span><span class="p">,</span> <span class="s2">&#34;_create_unverified_context&#34;</span><span class="p">,</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Download and prepare data</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">force_download</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&#34;seattle_weather_fremont.csv&#34;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s2">&#34;Date&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&#34;%m/</span><span class="si">%d</span><span class="s2">/%Y %I:%M:%S %p&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;total&#34;</span><span class="p">,</span> <span class="s2">&#34;west&#34;</span><span class="p">,</span> <span class="s2">&#34;east&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">hours_of_daylight</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mf">23.44</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="mf">47.61</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Compute the hours of daylight for the given date&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">diff</span> <span class="o">=</span> <span class="n">date</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">day</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mf">24.0</span> <span class="o">/</span> <span class="mi">3600</span>
</span></span><span class="line"><span class="cl">    <span class="n">day</span> <span class="o">%=</span> <span class="mf">365.25</span>
</span></span><span class="line"><span class="cl">    <span class="n">m</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">latitude</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">day</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">182.625</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">m</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mf">24.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">m</span><span class="p">))</span> <span class="o">/</span> <span class="mf">180.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">print_rms</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Calculates and prints the root-mean-square about the trend line&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">rms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Root-mean-square about trend: </span><span class="si">{0: .0f}</span><span class="s2"> riders&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rms</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">csnap</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Custom Help function to print things in method chaining.
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns back the df to further use in chaining.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">display</span><span class="p">(</span><span class="n">fn</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">df</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="unsupervised-exploration">Unsupervised exploration</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Load data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">start</span> <span class="o">=</span> <span class="s2">&#34;1 Oct 2012&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">end</span> <span class="o">=</span> <span class="s2">&#34;30 Jun 2015&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="n">get_fremont_data</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>/var/folders/xg/n9p73cf50s52twlnz7z778vr0000gn/T/ipykernel_3899/1377138058.py:7: FutureWarning: Value based partial slicing on non-monotonic DatetimeIndexes with non-existing keys is deprecated and will raise a KeyError in a future Version.
  data = data.loc[start:end]
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
<thead>
<tr>
<th></th>
<th>total</th>
<th>west</th>
<th>east</th>
</tr>
</thead>
<tbody>
<tr>
<td>Date</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>2012-10-03 00:00:00</td>
<td>13.0</td>
<td>4.0</td>
<td>9.0</td>
</tr>
<tr>
<td>2012-10-03 01:00:00</td>
<td>10.0</td>
<td>4.0</td>
<td>6.0</td>
</tr>
<tr>
<td>2012-10-03 02:00:00</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
</tbody>
</table>
</div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># A first look at the data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&#34;w&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1a23e32850&gt;
</code></pre>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="seattle-bicycle-traffic_files/figure-markdown_strict/cell-5-output-2.png"
        data-srcset="seattle-bicycle-traffic_files/figure-markdown_strict/cell-5-output-2.png, seattle-bicycle-traffic_files/figure-markdown_strict/cell-5-output-2.png 1.5x, seattle-bicycle-traffic_files/figure-markdown_strict/cell-5-output-2.png 2x"
        data-sizes="auto"
        alt="seattle-bicycle-traffic_files/figure-markdown_strict/cell-5-output-2.png"
        title="seattle-bicycle-traffic_files/figure-markdown_strict/cell-5-output-2.png" /></p>
<p>Same graph as above using Altair</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Create a melted dataset</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">melted</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&#34;w&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;Date&#34;</span><span class="p">:</span> <span class="s2">&#34;date&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">melt</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">id_vars</span><span class="o">=</span><span class="s2">&#34;date&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">var_name</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;side&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="n">value_name</span><span class="o">=</span><span class="s2">&#34;crossings&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;total&#34;</span><span class="p">,</span> <span class="s2">&#34;east&#34;</span><span class="p">,</span> <span class="s2">&#34;west&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">melted</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
<thead>
<tr>
<th></th>
<th>date</th>
<th>side</th>
<th>crossings</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>2012-10-07</td>
<td>total</td>
<td>14292.0</td>
</tr>
<tr>
<td>1</td>
<td>2012-10-14</td>
<td>total</td>
<td>16795.0</td>
</tr>
<tr>
<td>2</td>
<td>2012-10-21</td>
<td>total</td>
<td>15509.0</td>
</tr>
<tr>
<td>3</td>
<td>2012-10-28</td>
<td>total</td>
<td>13437.0</td>
</tr>
<tr>
<td>4</td>
<td>2012-11-04</td>
<td>total</td>
<td>12194.0</td>
</tr>
</tbody>
</table>
</div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Produce same graph as above</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&#34;date&#34;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&#34;crossings&#34;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&#34;side&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><script type="application/javascript">
const spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"name": "data-22ebd49c3361b546e8566c4d6f0be1bc"}, "mark": "line", "encoding": {"color": {"type": "nominal", "field": "side"}, "x": {"type": "temporal", "field": "date"}, "y": {"type": "quantitative", "field": "crossings"}}, "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json", "datasets": {"data-22ebd49c3361b546e8566c4d6f0be1bc": [{"date": "2012-10-07T00:00:00", "side": "total", "crossings": 14292.0}, {"date": "2012-10-14T00:00:00", "side": "total", "crossings": 16795.0}, {"date": "2012-10-21T00:00:00", "side": "total", "crossings": 15509.0}, {"date": "2012-10-28T00:00:00", "side": "total", "crossings": 13437.0}, {"date": "2012-11-04T00:00:00", "side": "total", "crossings": 12194.0}, {"date": "2012-11-11T00:00:00", "side": "total", "crossings": 15016.0}, {"date": "2012-11-18T00:00:00", "side": "total", "crossings": 11876.0}, {"date": "2012-11-25T00:00:00", "side": "total", "crossings": 6850.0}, {"date": "2012-12-02T00:00:00", "side": "total", "crossings": 11534.0}, {"date": "2012-12-09T00:00:00", "side": "total", "crossings": 11170.0}, {"date": "2012-12-16T00:00:00", "side": "total", "crossings": 10491.0}, {"date": "2012-12-23T00:00:00", "side": "total", "crossings": 7457.0}, {"date": "2012-12-30T00:00:00", "side": "total", "crossings": 5104.0}, {"date": "2013-01-06T00:00:00", "side": "total", "crossings": 8439.0}, {"date": "2013-01-13T00:00:00", "side": "total", "crossings": 9434.0}, {"date": "2013-01-20T00:00:00", "side": "total", "crossings": 10808.0}, {"date": "2013-01-27T00:00:00", "side": "total", "crossings": 10011.0}, {"date": "2013-02-03T00:00:00", "side": "total", "crossings": 11287.0}, {"date": "2013-02-10T00:00:00", "side": "total", "crossings": 13069.0}, {"date": "2013-02-17T00:00:00", "side": "total", "crossings": 12390.0}, {"date": "2013-02-24T00:00:00", "side": "total", "crossings": 11783.0}, {"date": "2013-03-03T00:00:00", "side": "total", "crossings": 13444.0}, {"date": "2013-03-10T00:00:00", "side": "total", "crossings": 15595.0}, {"date": "2013-03-17T00:00:00", "side": "total", "crossings": 13039.0}, {"date": "2013-03-24T00:00:00", "side": "total", "crossings": 13123.0}, {"date": "2013-03-31T00:00:00", "side": "total", "crossings": 19564.0}, {"date": "2013-04-07T00:00:00", "side": "total", "crossings": 15236.0}, {"date": "2013-04-14T00:00:00", "side": "total", "crossings": 14556.0}, {"date": "2013-04-21T00:00:00", "side": "total", "crossings": 14059.0}, {"date": "2013-04-28T00:00:00", "side": "total", "crossings": 22052.0}, {"date": "2013-05-05T00:00:00", "side": "total", "crossings": 26424.0}, {"date": "2013-05-12T00:00:00", "side": "total", "crossings": 28414.0}, {"date": "2013-05-19T00:00:00", "side": "total", "crossings": 24845.0}, {"date": "2013-05-26T00:00:00", "side": "total", "crossings": 19343.0}, {"date": "2013-06-02T00:00:00", "side": "total", "crossings": 20559.0}, {"date": "2013-06-09T00:00:00", "side": "total", "crossings": 27026.0}, {"date": "2013-06-16T00:00:00", "side": "total", "crossings": 24147.0}, {"date": "2013-06-23T00:00:00", "side": "total", "crossings": 22701.0}, {"date": "2013-06-30T00:00:00", "side": "total", "crossings": 20490.0}, {"date": "2013-07-07T00:00:00", "side": "total", "crossings": 25512.0}, {"date": "2013-07-14T00:00:00", "side": "total", "crossings": 26904.0}, {"date": "2013-07-21T00:00:00", "side": "total", "crossings": 26419.0}, {"date": "2013-07-28T00:00:00", "side": "total", "crossings": 26389.0}, {"date": "2013-08-04T00:00:00", "side": "total", "crossings": 23771.0}, {"date": "2013-08-11T00:00:00", "side": "total", "crossings": 25790.0}, {"date": "2013-08-18T00:00:00", "side": "total", "crossings": 24341.0}, {"date": "2013-08-25T00:00:00", "side": "total", "crossings": 24738.0}, {"date": "2013-09-01T00:00:00", "side": "total", "crossings": 20947.0}, {"date": "2013-09-08T00:00:00", "side": "total", "crossings": 17768.0}, {"date": "2013-09-15T00:00:00", "side": "total", "crossings": 22682.0}, {"date": "2013-09-22T00:00:00", "side": "total", "crossings": 20438.0}, {"date": "2013-09-29T00:00:00", "side": "total", "crossings": 15294.0}, {"date": "2013-10-06T00:00:00", "side": "total", "crossings": 18189.0}, {"date": "2013-10-13T00:00:00", "side": "total", "crossings": 17712.0}, {"date": "2013-10-20T00:00:00", "side": "total", "crossings": 18656.0}, {"date": "2013-10-27T00:00:00", "side": "total", "crossings": 16847.0}, {"date": "2013-11-03T00:00:00", "side": "total", "crossings": 17010.0}, {"date": "2013-11-10T00:00:00", "side": "total", "crossings": 15289.0}, {"date": "2013-11-17T00:00:00", "side": "total", "crossings": 14885.0}, {"date": "2013-11-24T00:00:00", "side": "total", "crossings": 14441.0}, {"date": "2013-12-01T00:00:00", "side": "total", "crossings": 10533.0}, {"date": "2013-12-08T00:00:00", "side": "total", "crossings": 11268.0}, {"date": "2013-12-15T00:00:00", "side": "total", "crossings": 11141.0}, {"date": "2013-12-22T00:00:00", "side": "total", "crossings": 10637.0}, {"date": "2013-12-29T00:00:00", "side": "total", "crossings": 6685.0}, {"date": "2014-01-05T00:00:00", "side": "total", "crossings": 10270.0}, {"date": "2014-01-12T00:00:00", "side": "total", "crossings": 11312.0}, {"date": "2014-01-19T00:00:00", "side": "total", "crossings": 15018.0}, {"date": "2014-01-26T00:00:00", "side": "total", "crossings": 15286.0}, {"date": "2014-02-02T00:00:00", "side": "total", "crossings": 13357.0}, {"date": "2014-02-09T00:00:00", "side": "total", "crossings": 11119.0}, {"date": "2014-02-16T00:00:00", "side": "total", "crossings": 10909.0}, {"date": "2014-02-23T00:00:00", "side": "total", "crossings": 10138.0}, {"date": "2014-03-02T00:00:00", "side": "total", "crossings": 14050.0}, {"date": "2014-03-09T00:00:00", "side": "total", "crossings": 11876.0}, {"date": "2014-03-16T00:00:00", "side": "total", "crossings": 16307.0}, {"date": "2014-03-23T00:00:00", "side": "total", "crossings": 16613.0}, {"date": "2014-03-30T00:00:00", "side": "total", "crossings": 13842.0}, {"date": "2014-04-06T00:00:00", "side": "total", "crossings": 18926.0}, {"date": "2014-04-13T00:00:00", "side": "total", "crossings": 23160.0}, {"date": "2014-04-20T00:00:00", "side": "total", "crossings": 16665.0}, {"date": "2014-04-27T00:00:00", "side": "total", "crossings": 17812.0}, {"date": "2014-05-04T00:00:00", "side": "total", "crossings": 26050.0}, {"date": "2014-05-11T00:00:00", "side": "total", "crossings": 23759.0}, {"date": "2014-05-18T00:00:00", "side": "total", "crossings": 32427.0}, {"date": "2014-05-25T00:00:00", "side": "total", "crossings": 26464.0}, {"date": "2014-06-01T00:00:00", "side": "total", "crossings": 26273.0}, {"date": "2014-06-08T00:00:00", "side": "total", "crossings": 29858.0}, {"date": "2014-06-15T00:00:00", "side": "total", "crossings": 23237.0}, {"date": "2014-06-22T00:00:00", "side": "total", "crossings": 26238.0}, {"date": "2014-06-29T00:00:00", "side": "total", "crossings": 24171.0}, {"date": "2014-07-06T00:00:00", "side": "total", "crossings": 26592.0}, {"date": "2014-07-13T00:00:00", "side": "total", "crossings": 28552.0}, {"date": "2014-07-20T00:00:00", "side": "total", "crossings": 26686.0}, {"date": "2014-07-27T00:00:00", "side": "total", "crossings": 23703.0}, {"date": "2014-08-03T00:00:00", "side": "total", "crossings": 28671.0}, {"date": "2014-08-10T00:00:00", "side": "total", "crossings": 27775.0}, {"date": "2014-08-17T00:00:00", "side": "total", "crossings": 23359.0}, {"date": "2014-08-24T00:00:00", "side": "total", "crossings": 26767.0}, {"date": "2014-08-31T00:00:00", "side": "total", "crossings": 25856.0}, {"date": "2014-09-07T00:00:00", "side": "total", "crossings": 23711.0}, {"date": "2014-09-14T00:00:00", "side": "total", "crossings": 24305.0}, {"date": "2014-09-21T00:00:00", "side": "total", "crossings": 23961.0}, {"date": "2014-09-28T00:00:00", "side": "total", "crossings": 18984.0}, {"date": "2014-10-05T00:00:00", "side": "total", "crossings": 22141.0}, {"date": "2014-10-12T00:00:00", "side": "total", "crossings": 21028.0}, {"date": "2014-10-19T00:00:00", "side": "total", "crossings": 18571.0}, {"date": "2014-10-26T00:00:00", "side": "total", "crossings": 14724.0}, {"date": "2014-11-02T00:00:00", "side": "total", "crossings": 15683.0}, {"date": "2014-11-09T00:00:00", "side": "total", "crossings": 15997.0}, {"date": "2014-11-16T00:00:00", "side": "total", "crossings": 15667.0}, {"date": "2014-11-23T00:00:00", "side": "total", "crossings": 14690.0}, {"date": "2014-11-30T00:00:00", "side": "total", "crossings": 8270.0}, {"date": "2014-12-07T00:00:00", "side": "total", "crossings": 12362.0}, {"date": "2014-12-14T00:00:00", "side": "total", "crossings": 12822.0}, {"date": "2014-12-21T00:00:00", "side": "total", "crossings": 11745.0}, {"date": "2014-12-28T00:00:00", "side": "total", "crossings": 7106.0}, {"date": "2015-01-04T00:00:00", "side": "total", "crossings": 7553.0}, {"date": "2015-01-11T00:00:00", "side": "total", "crossings": 14054.0}, {"date": "2015-01-18T00:00:00", "side": "total", "crossings": 13162.0}, {"date": "2015-01-25T00:00:00", "side": "total", "crossings": 14739.0}, {"date": "2015-02-01T00:00:00", "side": "total", "crossings": 16302.0}, {"date": "2015-02-08T00:00:00", "side": "total", "crossings": 11945.0}, {"date": "2015-02-15T00:00:00", "side": "total", "crossings": 15885.0}, {"date": "2015-02-22T00:00:00", "side": "total", "crossings": 15766.0}, {"date": "2015-03-01T00:00:00", "side": "total", "crossings": 16127.0}, {"date": "2015-03-08T00:00:00", "side": "total", "crossings": 18286.0}, {"date": "2015-03-15T00:00:00", "side": "total", "crossings": 14735.0}, {"date": "2015-03-22T00:00:00", "side": "total", "crossings": 14956.0}, {"date": "2015-03-29T00:00:00", "side": "total", "crossings": 16034.0}, {"date": "2015-04-05T00:00:00", "side": "total", "crossings": 16943.0}, {"date": "2015-04-12T00:00:00", "side": "total", "crossings": 18208.0}, {"date": "2015-04-19T00:00:00", "side": "total", "crossings": 20911.0}, {"date": "2015-04-26T00:00:00", "side": "total", "crossings": 19066.0}, {"date": "2015-05-03T00:00:00", "side": "total", "crossings": 22604.0}, {"date": "2015-05-10T00:00:00", "side": "total", "crossings": 25435.0}, {"date": "2015-05-17T00:00:00", "side": "total", "crossings": 22566.0}, {"date": "2015-05-24T00:00:00", "side": "total", "crossings": 26089.0}, {"date": "2015-05-31T00:00:00", "side": "total", "crossings": 25011.0}, {"date": "2015-06-07T00:00:00", "side": "total", "crossings": 23657.0}, {"date": "2015-06-14T00:00:00", "side": "total", "crossings": 28119.0}, {"date": "2015-06-21T00:00:00", "side": "total", "crossings": 26037.0}, {"date": "2015-06-28T00:00:00", "side": "total", "crossings": 27068.0}, {"date": "2015-07-05T00:00:00", "side": "total", "crossings": 8836.0}, {"date": "2012-10-07T00:00:00", "side": "east", "crossings": 6995.0}, {"date": "2012-10-14T00:00:00", "side": "east", "crossings": 8116.0}, {"date": "2012-10-21T00:00:00", "side": "east", "crossings": 7563.0}, {"date": "2012-10-28T00:00:00", "side": "east", "crossings": 6536.0}, {"date": "2012-11-04T00:00:00", "side": "east", "crossings": 5786.0}, {"date": "2012-11-11T00:00:00", "side": "east", "crossings": 7275.0}, {"date": "2012-11-18T00:00:00", "side": "east", "crossings": 5799.0}, {"date": "2012-11-25T00:00:00", "side": "east", "crossings": 3316.0}, {"date": "2012-12-02T00:00:00", "side": "east", "crossings": 5659.0}, {"date": "2012-12-09T00:00:00", "side": "east", "crossings": 5488.0}, {"date": "2012-12-16T00:00:00", "side": "east", "crossings": 5107.0}, {"date": "2012-12-23T00:00:00", "side": "east", "crossings": 3705.0}, {"date": "2012-12-30T00:00:00", "side": "east", "crossings": 2492.0}, {"date": "2013-01-06T00:00:00", "side": "east", "crossings": 4124.0}, {"date": "2013-01-13T00:00:00", "side": "east", "crossings": 4573.0}, {"date": "2013-01-20T00:00:00", "side": "east", "crossings": 5258.0}, {"date": "2013-01-27T00:00:00", "side": "east", "crossings": 4915.0}, {"date": "2013-02-03T00:00:00", "side": "east", "crossings": 5439.0}, {"date": "2013-02-10T00:00:00", "side": "east", "crossings": 6253.0}, {"date": "2013-02-17T00:00:00", "side": "east", "crossings": 5952.0}, {"date": "2013-02-24T00:00:00", "side": "east", "crossings": 5720.0}, {"date": "2013-03-03T00:00:00", "side": "east", "crossings": 6507.0}, {"date": "2013-03-10T00:00:00", "side": "east", "crossings": 7434.0}, {"date": "2013-03-17T00:00:00", "side": "east", "crossings": 6315.0}, {"date": "2013-03-24T00:00:00", "side": "east", "crossings": 6355.0}, {"date": "2013-03-31T00:00:00", "side": "east", "crossings": 9344.0}, {"date": "2013-04-07T00:00:00", "side": "east", "crossings": 7485.0}, {"date": "2013-04-14T00:00:00", "side": "east", "crossings": 7030.0}, {"date": "2013-04-21T00:00:00", "side": "east", "crossings": 6672.0}, {"date": "2013-04-28T00:00:00", "side": "east", "crossings": 10546.0}, {"date": "2013-05-05T00:00:00", "side": "east", "crossings": 12520.0}, {"date": "2013-05-12T00:00:00", "side": "east", "crossings": 13551.0}, {"date": "2013-05-19T00:00:00", "side": "east", "crossings": 11725.0}, {"date": "2013-05-26T00:00:00", "side": "east", "crossings": 9325.0}, {"date": "2013-06-02T00:00:00", "side": "east", "crossings": 9658.0}, {"date": "2013-06-09T00:00:00", "side": "east", "crossings": 13023.0}, {"date": "2013-06-16T00:00:00", "side": "east", "crossings": 11558.0}, {"date": "2013-06-23T00:00:00", "side": "east", "crossings": 11242.0}, {"date": "2013-06-30T00:00:00", "side": "east", "crossings": 9938.0}, {"date": "2013-07-07T00:00:00", "side": "east", "crossings": 12430.0}, {"date": "2013-07-14T00:00:00", "side": "east", "crossings": 13218.0}, {"date": "2013-07-21T00:00:00", "side": "east", "crossings": 12880.0}, {"date": "2013-07-28T00:00:00", "side": "east", "crossings": 13047.0}, {"date": "2013-08-04T00:00:00", "side": "east", "crossings": 11624.0}, {"date": "2013-08-11T00:00:00", "side": "east", "crossings": 12633.0}, {"date": "2013-08-18T00:00:00", "side": "east", "crossings": 11958.0}, {"date": "2013-08-25T00:00:00", "side": "east", "crossings": 12357.0}, {"date": "2013-09-01T00:00:00", "side": "east", "crossings": 10189.0}, {"date": "2013-09-08T00:00:00", "side": "east", "crossings": 8498.0}, {"date": "2013-09-15T00:00:00", "side": "east", "crossings": 11197.0}, {"date": "2013-09-22T00:00:00", "side": "east", "crossings": 9838.0}, {"date": "2013-09-29T00:00:00", "side": "east", "crossings": 7403.0}, {"date": "2013-10-06T00:00:00", "side": "east", "crossings": 8592.0}, {"date": "2013-10-13T00:00:00", "side": "east", "crossings": 8570.0}, {"date": "2013-10-20T00:00:00", "side": "east", "crossings": 8889.0}, {"date": "2013-10-27T00:00:00", "side": "east", "crossings": 8392.0}, {"date": "2013-11-03T00:00:00", "side": "east", "crossings": 8109.0}, {"date": "2013-11-10T00:00:00", "side": "east", "crossings": 7497.0}, {"date": "2013-11-17T00:00:00", "side": "east", "crossings": 7290.0}, {"date": "2013-11-24T00:00:00", "side": "east", "crossings": 6923.0}, {"date": "2013-12-01T00:00:00", "side": "east", "crossings": 5053.0}, {"date": "2013-12-08T00:00:00", "side": "east", "crossings": 5432.0}, {"date": "2013-12-15T00:00:00", "side": "east", "crossings": 5381.0}, {"date": "2013-12-22T00:00:00", "side": "east", "crossings": 5182.0}, {"date": "2013-12-29T00:00:00", "side": "east", "crossings": 3118.0}, {"date": "2014-01-05T00:00:00", "side": "east", "crossings": 4865.0}, {"date": "2014-01-12T00:00:00", "side": "east", "crossings": 5492.0}, {"date": "2014-01-19T00:00:00", "side": "east", "crossings": 7263.0}, {"date": "2014-01-26T00:00:00", "side": "east", "crossings": 7376.0}, {"date": "2014-02-02T00:00:00", "side": "east", "crossings": 6448.0}, {"date": "2014-02-09T00:00:00", "side": "east", "crossings": 5508.0}, {"date": "2014-02-16T00:00:00", "side": "east", "crossings": 5340.0}, {"date": "2014-02-23T00:00:00", "side": "east", "crossings": 5029.0}, {"date": "2014-03-02T00:00:00", "side": "east", "crossings": 6671.0}, {"date": "2014-03-09T00:00:00", "side": "east", "crossings": 5704.0}, {"date": "2014-03-16T00:00:00", "side": "east", "crossings": 7897.0}, {"date": "2014-03-23T00:00:00", "side": "east", "crossings": 8039.0}, {"date": "2014-03-30T00:00:00", "side": "east", "crossings": 6692.0}, {"date": "2014-04-06T00:00:00", "side": "east", "crossings": 9125.0}, {"date": "2014-04-13T00:00:00", "side": "east", "crossings": 11153.0}, {"date": "2014-04-20T00:00:00", "side": "east", "crossings": 8149.0}, {"date": "2014-04-27T00:00:00", "side": "east", "crossings": 8675.0}, {"date": "2014-05-04T00:00:00", "side": "east", "crossings": 12518.0}, {"date": "2014-05-11T00:00:00", "side": "east", "crossings": 11276.0}, {"date": "2014-05-18T00:00:00", "side": "east", "crossings": 15580.0}, {"date": "2014-05-25T00:00:00", "side": "east", "crossings": 13000.0}, {"date": "2014-06-01T00:00:00", "side": "east", "crossings": 12589.0}, {"date": "2014-06-08T00:00:00", "side": "east", "crossings": 14646.0}, {"date": "2014-06-15T00:00:00", "side": "east", "crossings": 11386.0}, {"date": "2014-06-22T00:00:00", "side": "east", "crossings": 13023.0}, {"date": "2014-06-29T00:00:00", "side": "east", "crossings": 11977.0}, {"date": "2014-07-06T00:00:00", "side": "east", "crossings": 13240.0}, {"date": "2014-07-13T00:00:00", "side": "east", "crossings": 13926.0}, {"date": "2014-07-20T00:00:00", "side": "east", "crossings": 13235.0}, {"date": "2014-07-27T00:00:00", "side": "east", "crossings": 11486.0}, {"date": "2014-08-03T00:00:00", "side": "east", "crossings": 14226.0}, {"date": "2014-08-10T00:00:00", "side": "east", "crossings": 13886.0}, {"date": "2014-08-17T00:00:00", "side": "east", "crossings": 11737.0}, {"date": "2014-08-24T00:00:00", "side": "east", "crossings": 13424.0}, {"date": "2014-08-31T00:00:00", "side": "east", "crossings": 12988.0}, {"date": "2014-09-07T00:00:00", "side": "east", "crossings": 11416.0}, {"date": "2014-09-14T00:00:00", "side": "east", "crossings": 11943.0}, {"date": "2014-09-21T00:00:00", "side": "east", "crossings": 11411.0}, {"date": "2014-09-28T00:00:00", "side": "east", "crossings": 8758.0}, {"date": "2014-10-05T00:00:00", "side": "east", "crossings": 9635.0}, {"date": "2014-10-12T00:00:00", "side": "east", "crossings": 9043.0}, {"date": "2014-10-19T00:00:00", "side": "east", "crossings": 8131.0}, {"date": "2014-10-26T00:00:00", "side": "east", "crossings": 7687.0}, {"date": "2014-11-02T00:00:00", "side": "east", "crossings": 8060.0}, {"date": "2014-11-09T00:00:00", "side": "east", "crossings": 8612.0}, {"date": "2014-11-16T00:00:00", "side": "east", "crossings": 8148.0}, {"date": "2014-11-23T00:00:00", "side": "east", "crossings": 7420.0}, {"date": "2014-11-30T00:00:00", "side": "east", "crossings": 3785.0}, {"date": "2014-12-07T00:00:00", "side": "east", "crossings": 6361.0}, {"date": "2014-12-14T00:00:00", "side": "east", "crossings": 6494.0}, {"date": "2014-12-21T00:00:00", "side": "east", "crossings": 6338.0}, {"date": "2014-12-28T00:00:00", "side": "east", "crossings": 3443.0}, {"date": "2015-01-04T00:00:00", "side": "east", "crossings": 3613.0}, {"date": "2015-01-11T00:00:00", "side": "east", "crossings": 5547.0}, {"date": "2015-01-18T00:00:00", "side": "east", "crossings": 5004.0}, {"date": "2015-01-25T00:00:00", "side": "east", "crossings": 6104.0}, {"date": "2015-02-01T00:00:00", "side": "east", "crossings": 7108.0}, {"date": "2015-02-08T00:00:00", "side": "east", "crossings": 4747.0}, {"date": "2015-02-15T00:00:00", "side": "east", "crossings": 7343.0}, {"date": "2015-02-22T00:00:00", "side": "east", "crossings": 7110.0}, {"date": "2015-03-01T00:00:00", "side": "east", "crossings": 7119.0}, {"date": "2015-03-08T00:00:00", "side": "east", "crossings": 8525.0}, {"date": "2015-03-15T00:00:00", "side": "east", "crossings": 9099.0}, {"date": "2015-03-22T00:00:00", "side": "east", "crossings": 8611.0}, {"date": "2015-03-29T00:00:00", "side": "east", "crossings": 6771.0}, {"date": "2015-04-05T00:00:00", "side": "east", "crossings": 8487.0}, {"date": "2015-04-12T00:00:00", "side": "east", "crossings": 8431.0}, {"date": "2015-04-19T00:00:00", "side": "east", "crossings": 9854.0}, {"date": "2015-04-26T00:00:00", "side": "east", "crossings": 9215.0}, {"date": "2015-05-03T00:00:00", "side": "east", "crossings": 10960.0}, {"date": "2015-05-10T00:00:00", "side": "east", "crossings": 12380.0}, {"date": "2015-05-17T00:00:00", "side": "east", "crossings": 10843.0}, {"date": "2015-05-24T00:00:00", "side": "east", "crossings": 12955.0}, {"date": "2015-05-31T00:00:00", "side": "east", "crossings": 12293.0}, {"date": "2015-06-07T00:00:00", "side": "east", "crossings": 11784.0}, {"date": "2015-06-14T00:00:00", "side": "east", "crossings": 13915.0}, {"date": "2015-06-21T00:00:00", "side": "east", "crossings": 13141.0}, {"date": "2015-06-28T00:00:00", "side": "east", "crossings": 13412.0}, {"date": "2015-07-05T00:00:00", "side": "east", "crossings": 4389.0}, {"date": "2012-10-07T00:00:00", "side": "west", "crossings": 7297.0}, {"date": "2012-10-14T00:00:00", "side": "west", "crossings": 8679.0}, {"date": "2012-10-21T00:00:00", "side": "west", "crossings": 7946.0}, {"date": "2012-10-28T00:00:00", "side": "west", "crossings": 6901.0}, {"date": "2012-11-04T00:00:00", "side": "west", "crossings": 6408.0}, {"date": "2012-11-11T00:00:00", "side": "west", "crossings": 7741.0}, {"date": "2012-11-18T00:00:00", "side": "west", "crossings": 6077.0}, {"date": "2012-11-25T00:00:00", "side": "west", "crossings": 3534.0}, {"date": "2012-12-02T00:00:00", "side": "west", "crossings": 5875.0}, {"date": "2012-12-09T00:00:00", "side": "west", "crossings": 5682.0}, {"date": "2012-12-16T00:00:00", "side": "west", "crossings": 5384.0}, {"date": "2012-12-23T00:00:00", "side": "west", "crossings": 3752.0}, {"date": "2012-12-30T00:00:00", "side": "west", "crossings": 2612.0}, {"date": "2013-01-06T00:00:00", "side": "west", "crossings": 4315.0}, {"date": "2013-01-13T00:00:00", "side": "west", "crossings": 4861.0}, {"date": "2013-01-20T00:00:00", "side": "west", "crossings": 5550.0}, {"date": "2013-01-27T00:00:00", "side": "west", "crossings": 5096.0}, {"date": "2013-02-03T00:00:00", "side": "west", "crossings": 5848.0}, {"date": "2013-02-10T00:00:00", "side": "west", "crossings": 6816.0}, {"date": "2013-02-17T00:00:00", "side": "west", "crossings": 6438.0}, {"date": "2013-02-24T00:00:00", "side": "west", "crossings": 6063.0}, {"date": "2013-03-03T00:00:00", "side": "west", "crossings": 6937.0}, {"date": "2013-03-10T00:00:00", "side": "west", "crossings": 8161.0}, {"date": "2013-03-17T00:00:00", "side": "west", "crossings": 6724.0}, {"date": "2013-03-24T00:00:00", "side": "west", "crossings": 6768.0}, {"date": "2013-03-31T00:00:00", "side": "west", "crossings": 10220.0}, {"date": "2013-04-07T00:00:00", "side": "west", "crossings": 7751.0}, {"date": "2013-04-14T00:00:00", "side": "west", "crossings": 7526.0}, {"date": "2013-04-21T00:00:00", "side": "west", "crossings": 7387.0}, {"date": "2013-04-28T00:00:00", "side": "west", "crossings": 11506.0}, {"date": "2013-05-05T00:00:00", "side": "west", "crossings": 13904.0}, {"date": "2013-05-12T00:00:00", "side": "west", "crossings": 14863.0}, {"date": "2013-05-19T00:00:00", "side": "west", "crossings": 13120.0}, {"date": "2013-05-26T00:00:00", "side": "west", "crossings": 10018.0}, {"date": "2013-06-02T00:00:00", "side": "west", "crossings": 10901.0}, {"date": "2013-06-09T00:00:00", "side": "west", "crossings": 14003.0}, {"date": "2013-06-16T00:00:00", "side": "west", "crossings": 12589.0}, {"date": "2013-06-23T00:00:00", "side": "west", "crossings": 11459.0}, {"date": "2013-06-30T00:00:00", "side": "west", "crossings": 10552.0}, {"date": "2013-07-07T00:00:00", "side": "west", "crossings": 13082.0}, {"date": "2013-07-14T00:00:00", "side": "west", "crossings": 13686.0}, {"date": "2013-07-21T00:00:00", "side": "west", "crossings": 13539.0}, {"date": "2013-07-28T00:00:00", "side": "west", "crossings": 13342.0}, {"date": "2013-08-04T00:00:00", "side": "west", "crossings": 12147.0}, {"date": "2013-08-11T00:00:00", "side": "west", "crossings": 13157.0}, {"date": "2013-08-18T00:00:00", "side": "west", "crossings": 12383.0}, {"date": "2013-08-25T00:00:00", "side": "west", "crossings": 12381.0}, {"date": "2013-09-01T00:00:00", "side": "west", "crossings": 10758.0}, {"date": "2013-09-08T00:00:00", "side": "west", "crossings": 9270.0}, {"date": "2013-09-15T00:00:00", "side": "west", "crossings": 11485.0}, {"date": "2013-09-22T00:00:00", "side": "west", "crossings": 10600.0}, {"date": "2013-09-29T00:00:00", "side": "west", "crossings": 7891.0}, {"date": "2013-10-06T00:00:00", "side": "west", "crossings": 9597.0}, {"date": "2013-10-13T00:00:00", "side": "west", "crossings": 9142.0}, {"date": "2013-10-20T00:00:00", "side": "west", "crossings": 9767.0}, {"date": "2013-10-27T00:00:00", "side": "west", "crossings": 8455.0}, {"date": "2013-11-03T00:00:00", "side": "west", "crossings": 8901.0}, {"date": "2013-11-10T00:00:00", "side": "west", "crossings": 7792.0}, {"date": "2013-11-17T00:00:00", "side": "west", "crossings": 7595.0}, {"date": "2013-11-24T00:00:00", "side": "west", "crossings": 7518.0}, {"date": "2013-12-01T00:00:00", "side": "west", "crossings": 5480.0}, {"date": "2013-12-08T00:00:00", "side": "west", "crossings": 5836.0}, {"date": "2013-12-15T00:00:00", "side": "west", "crossings": 5760.0}, {"date": "2013-12-22T00:00:00", "side": "west", "crossings": 5455.0}, {"date": "2013-12-29T00:00:00", "side": "west", "crossings": 3567.0}, {"date": "2014-01-05T00:00:00", "side": "west", "crossings": 5405.0}, {"date": "2014-01-12T00:00:00", "side": "west", "crossings": 5820.0}, {"date": "2014-01-19T00:00:00", "side": "west", "crossings": 7755.0}, {"date": "2014-01-26T00:00:00", "side": "west", "crossings": 7910.0}, {"date": "2014-02-02T00:00:00", "side": "west", "crossings": 6909.0}, {"date": "2014-02-09T00:00:00", "side": "west", "crossings": 5611.0}, {"date": "2014-02-16T00:00:00", "side": "west", "crossings": 5569.0}, {"date": "2014-02-23T00:00:00", "side": "west", "crossings": 5109.0}, {"date": "2014-03-02T00:00:00", "side": "west", "crossings": 7379.0}, {"date": "2014-03-09T00:00:00", "side": "west", "crossings": 6172.0}, {"date": "2014-03-16T00:00:00", "side": "west", "crossings": 8410.0}, {"date": "2014-03-23T00:00:00", "side": "west", "crossings": 8574.0}, {"date": "2014-03-30T00:00:00", "side": "west", "crossings": 7150.0}, {"date": "2014-04-06T00:00:00", "side": "west", "crossings": 9801.0}, {"date": "2014-04-13T00:00:00", "side": "west", "crossings": 12007.0}, {"date": "2014-04-20T00:00:00", "side": "west", "crossings": 8516.0}, {"date": "2014-04-27T00:00:00", "side": "west", "crossings": 9137.0}, {"date": "2014-05-04T00:00:00", "side": "west", "crossings": 13532.0}, {"date": "2014-05-11T00:00:00", "side": "west", "crossings": 12483.0}, {"date": "2014-05-18T00:00:00", "side": "west", "crossings": 16847.0}, {"date": "2014-05-25T00:00:00", "side": "west", "crossings": 13464.0}, {"date": "2014-06-01T00:00:00", "side": "west", "crossings": 13684.0}, {"date": "2014-06-08T00:00:00", "side": "west", "crossings": 15212.0}, {"date": "2014-06-15T00:00:00", "side": "west", "crossings": 11851.0}, {"date": "2014-06-22T00:00:00", "side": "west", "crossings": 13215.0}, {"date": "2014-06-29T00:00:00", "side": "west", "crossings": 12194.0}, {"date": "2014-07-06T00:00:00", "side": "west", "crossings": 13352.0}, {"date": "2014-07-13T00:00:00", "side": "west", "crossings": 14626.0}, {"date": "2014-07-20T00:00:00", "side": "west", "crossings": 13451.0}, {"date": "2014-07-27T00:00:00", "side": "west", "crossings": 12217.0}, {"date": "2014-08-03T00:00:00", "side": "west", "crossings": 14445.0}, {"date": "2014-08-10T00:00:00", "side": "west", "crossings": 13889.0}, {"date": "2014-08-17T00:00:00", "side": "west", "crossings": 11622.0}, {"date": "2014-08-24T00:00:00", "side": "west", "crossings": 13343.0}, {"date": "2014-08-31T00:00:00", "side": "west", "crossings": 12868.0}, {"date": "2014-09-07T00:00:00", "side": "west", "crossings": 12295.0}, {"date": "2014-09-14T00:00:00", "side": "west", "crossings": 12362.0}, {"date": "2014-09-21T00:00:00", "side": "west", "crossings": 12550.0}, {"date": "2014-09-28T00:00:00", "side": "west", "crossings": 10226.0}, {"date": "2014-10-05T00:00:00", "side": "west", "crossings": 12506.0}, {"date": "2014-10-12T00:00:00", "side": "west", "crossings": 11985.0}, {"date": "2014-10-19T00:00:00", "side": "west", "crossings": 10440.0}, {"date": "2014-10-26T00:00:00", "side": "west", "crossings": 7037.0}, {"date": "2014-11-02T00:00:00", "side": "west", "crossings": 7623.0}, {"date": "2014-11-09T00:00:00", "side": "west", "crossings": 7385.0}, {"date": "2014-11-16T00:00:00", "side": "west", "crossings": 7519.0}, {"date": "2014-11-23T00:00:00", "side": "west", "crossings": 7270.0}, {"date": "2014-11-30T00:00:00", "side": "west", "crossings": 4485.0}, {"date": "2014-12-07T00:00:00", "side": "west", "crossings": 6001.0}, {"date": "2014-12-14T00:00:00", "side": "west", "crossings": 6328.0}, {"date": "2014-12-21T00:00:00", "side": "west", "crossings": 5407.0}, {"date": "2014-12-28T00:00:00", "side": "west", "crossings": 3663.0}, {"date": "2015-01-04T00:00:00", "side": "west", "crossings": 3940.0}, {"date": "2015-01-11T00:00:00", "side": "west", "crossings": 8507.0}, {"date": "2015-01-18T00:00:00", "side": "west", "crossings": 8158.0}, {"date": "2015-01-25T00:00:00", "side": "west", "crossings": 8635.0}, {"date": "2015-02-01T00:00:00", "side": "west", "crossings": 9194.0}, {"date": "2015-02-08T00:00:00", "side": "west", "crossings": 7198.0}, {"date": "2015-02-15T00:00:00", "side": "west", "crossings": 8542.0}, {"date": "2015-02-22T00:00:00", "side": "west", "crossings": 8656.0}, {"date": "2015-03-01T00:00:00", "side": "west", "crossings": 9008.0}, {"date": "2015-03-08T00:00:00", "side": "west", "crossings": 9761.0}, {"date": "2015-03-15T00:00:00", "side": "west", "crossings": 5636.0}, {"date": "2015-03-22T00:00:00", "side": "west", "crossings": 6345.0}, {"date": "2015-03-29T00:00:00", "side": "west", "crossings": 9263.0}, {"date": "2015-04-05T00:00:00", "side": "west", "crossings": 8456.0}, {"date": "2015-04-12T00:00:00", "side": "west", "crossings": 9777.0}, {"date": "2015-04-19T00:00:00", "side": "west", "crossings": 11057.0}, {"date": "2015-04-26T00:00:00", "side": "west", "crossings": 9851.0}, {"date": "2015-05-03T00:00:00", "side": "west", "crossings": 11644.0}, {"date": "2015-05-10T00:00:00", "side": "west", "crossings": 13055.0}, {"date": "2015-05-17T00:00:00", "side": "west", "crossings": 11723.0}, {"date": "2015-05-24T00:00:00", "side": "west", "crossings": 13134.0}, {"date": "2015-05-31T00:00:00", "side": "west", "crossings": 12718.0}, {"date": "2015-06-07T00:00:00", "side": "west", "crossings": 11873.0}, {"date": "2015-06-14T00:00:00", "side": "west", "crossings": 14204.0}, {"date": "2015-06-21T00:00:00", "side": "west", "crossings": 12896.0}, {"date": "2015-06-28T00:00:00", "side": "west", "crossings": 13656.0}, {"date": "2015-07-05T00:00:00", "side": "west", "crossings": 4447.0}]}};
const opt = {};
const type = "vega-lite";
const id = "9838b0f5-784c-4758-93d5-d6de3c3ca541";

const output_area = this;

require(["nbextensions/jupyter-vega/index"], function(vega) {
  const target = document.createElement("div");
  target.id = id;
  target.className = "vega-embed";

  const style = document.createElement("style");
  style.textContent = [
    ".vega-embed .error p {",
    "  color: firebrick;",
    "  font-size: 14px;",
    "}",
  ].join("\\n");

  // element is a jQuery wrapped DOM element inside the output area
  // see http://ipython.readthedocs.io/en/stable/api/generated/\
  // IPython.display.html#IPython.display.Javascript.__init__
  element[0].appendChild(target);
  element[0].appendChild(style);

  vega.render("#" + id, spec, type, opt, output_area);
}, function (err) {
  if (err.requireType !== "scripterror") {
    throw(err);
  }
});

</script>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="seattle-bicycle-traffic_files/figure-markdown_strict/cell-7-output-3.png"
        data-srcset="seattle-bicycle-traffic_files/figure-markdown_strict/cell-7-output-3.png, seattle-bicycle-traffic_files/figure-markdown_strict/cell-7-output-3.png 1.5x, seattle-bicycle-traffic_files/figure-markdown_strict/cell-7-output-3.png 2x"
        data-sizes="auto"
        alt="seattle-bicycle-traffic_files/figure-markdown_strict/cell-7-output-3.png"
        title="seattle-bicycle-traffic_files/figure-markdown_strict/cell-7-output-3.png" /></p>
<h3 id="visualising-the-data">Visualising the data</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Create a datframe with days as dates and index and hours as columns</span>
</span></span><span class="line"><span class="cl"><span class="n">pivoted</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span><span class="s2">&#34;west&#34;</span><span class="p">,</span> <span class="s2">&#34;east&#34;</span><span class="p">,</span> <span class="s2">&#34;total&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="n">index</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">columns</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">pivoted</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead tr th {
    text-align: left;
}
</code></pre>
<p></style></p>
<table>
<thead>
<tr>
<th></th>
<th>east</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th>...</th>
<th>west</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Date</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td>5</td>
<td>6</td>
<td>7</td>
<td>8</td>
<td>9</td>
<td>...</td>
<td>14</td>
<td>15</td>
<td>16</td>
<td>17</td>
<td>18</td>
<td>19</td>
<td>20</td>
<td>21</td>
<td>22</td>
<td>23</td>
</tr>
<tr>
<td>2012-10-03</td>
<td>9</td>
<td>6</td>
<td>1</td>
<td>3</td>
<td>1</td>
<td>10</td>
<td>50</td>
<td>95</td>
<td>146</td>
<td>104</td>
<td>...</td>
<td>77</td>
<td>72</td>
<td>133</td>
<td>192</td>
<td>122</td>
<td>59</td>
<td>29</td>
<td>25</td>
<td>24</td>
<td>5</td>
</tr>
<tr>
<td>2012-10-04</td>
<td>11</td>
<td>0</td>
<td>6</td>
<td>3</td>
<td>1</td>
<td>11</td>
<td>51</td>
<td>89</td>
<td>134</td>
<td>94</td>
<td>...</td>
<td>63</td>
<td>73</td>
<td>114</td>
<td>154</td>
<td>137</td>
<td>57</td>
<td>27</td>
<td>31</td>
<td>25</td>
<td>11</td>
</tr>
<tr>
<td>2012-10-05</td>
<td>7</td>
<td>4</td>
<td>3</td>
<td>2</td>
<td>2</td>
<td>7</td>
<td>37</td>
<td>101</td>
<td>119</td>
<td>81</td>
<td>...</td>
<td>63</td>
<td>80</td>
<td>120</td>
<td>144</td>
<td>107</td>
<td>42</td>
<td>27</td>
<td>11</td>
<td>10</td>
<td>16</td>
</tr>
<tr>
<td>2012-10-06</td>
<td>7</td>
<td>5</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>15</td>
<td>16</td>
<td>47</td>
<td>55</td>
<td>...</td>
<td>89</td>
<td>115</td>
<td>107</td>
<td>107</td>
<td>41</td>
<td>40</td>
<td>25</td>
<td>18</td>
<td>14</td>
<td>15</td>
</tr>
<tr>
<td>2012-10-07</td>
<td>5</td>
<td>5</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>3</td>
<td>8</td>
<td>12</td>
<td>26</td>
<td>36</td>
<td>...</td>
<td>126</td>
<td>122</td>
<td>132</td>
<td>118</td>
<td>68</td>
<td>26</td>
<td>19</td>
<td>12</td>
<td>9</td>
<td>5</td>
</tr>
</tbody>
</table>
<p>5 rows × 72 columns</p>
</div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Put raw values in a matrix</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">X</span> <span class="o">=</span> <span class="n">pivoted</span><span class="o">.</span><span class="n">values</span>
</span></span><span class="line"><span class="cl"><span class="n">X</span><span class="o">.</span><span class="n">shape</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>(1001, 72)
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Use PCA to reduce dimensionality (keep 90 percent of the variance)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Xpca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="mf">0.9</span><span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Xpca</span><span class="o">.</span><span class="n">shape</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>(1001, 2)
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">total_trips</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Xpca</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">Xpca</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">total_trips</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&#34;Paired&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&#34;Total trips&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>&lt;matplotlib.colorbar.Colorbar at 0x1a26ec9dd0&gt;
</code></pre>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="seattle-bicycle-traffic_files/figure-markdown_strict/cell-11-output-2.png"
        data-srcset="seattle-bicycle-traffic_files/figure-markdown_strict/cell-11-output-2.png, seattle-bicycle-traffic_files/figure-markdown_strict/cell-11-output-2.png 1.5x, seattle-bicycle-traffic_files/figure-markdown_strict/cell-11-output-2.png 2x"
        data-sizes="auto"
        alt="seattle-bicycle-traffic_files/figure-markdown_strict/cell-11-output-2.png"
        title="seattle-bicycle-traffic_files/figure-markdown_strict/cell-11-output-2.png" /></p>
<p>What can we learn from this graph? We can see that the days fall into two quite distinct cluster, one with a higher number of trips and one with a lower number of trips, that the number of trips increases along the length of each projected cluster (i.e. as we move away from the origin), and that close to the origin, the groups are less distinguishable. Overall, we can see that there are, in effect, two types of days for Seattle cyclists. This is indeed pretty cool.</p>
<h3 id="unsupervised-clustering">Unsupervised clustering</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Use a Gaussian mixture model to separate days into two clusters</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">gmm</span> <span class="o">=</span> <span class="n">GMM</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">covariance_type</span><span class="o">=</span><span class="s2">&#34;full&#34;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">gmm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xpca</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">cluster_label</span> <span class="o">=</span> <span class="n">gmm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xpca</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Xpca</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">Xpca</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">cluster_label</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&#34;Paired&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>&lt;matplotlib.collections.PathCollection at 0x1a249be050&gt;
</code></pre>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="seattle-bicycle-traffic_files/figure-markdown_strict/cell-12-output-2.png"
        data-srcset="seattle-bicycle-traffic_files/figure-markdown_strict/cell-12-output-2.png, seattle-bicycle-traffic_files/figure-markdown_strict/cell-12-output-2.png 1.5x, seattle-bicycle-traffic_files/figure-markdown_strict/cell-12-output-2.png 2x"
        data-sizes="auto"
        alt="seattle-bicycle-traffic_files/figure-markdown_strict/cell-12-output-2.png"
        title="seattle-bicycle-traffic_files/figure-markdown_strict/cell-12-output-2.png" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Add cluster labels to original data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pivoted</span><span class="p">[</span><span class="s2">&#34;cluster&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cluster_label</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pivoted</span><span class="p">[</span><span class="s2">&#34;cluster&#34;</span><span class="p">],</span> <span class="n">on</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
<thead>
<tr>
<th></th>
<th>total</th>
<th>west</th>
<th>east</th>
<th>cluster</th>
</tr>
</thead>
<tbody>
<tr>
<td>Date</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>2012-10-03 00:00:00</td>
<td>13.0</td>
<td>4.0</td>
<td>9.0</td>
<td>0</td>
</tr>
<tr>
<td>2012-10-03 01:00:00</td>
<td>10.0</td>
<td>4.0</td>
<td>6.0</td>
<td>0</td>
</tr>
<tr>
<td>2012-10-03 02:00:00</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>0</td>
</tr>
<tr>
<td>2012-10-03 03:00:00</td>
<td>5.0</td>
<td>2.0</td>
<td>3.0</td>
<td>0</td>
</tr>
<tr>
<td>2012-10-03 04:00:00</td>
<td>7.0</td>
<td>6.0</td>
<td>1.0</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Plot</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">hourly</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&#34;cluster&#34;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">time</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">hourly_ticks</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">hourly</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">xticks</span><span class="o">=</span><span class="n">hourly_ticks</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&#34;Cluster </span><span class="si">{0}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&#34;Average hourly trips&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="seattle-bicycle-traffic_files/figure-markdown_strict/cell-14-output-1.png"
        data-srcset="seattle-bicycle-traffic_files/figure-markdown_strict/cell-14-output-1.png, seattle-bicycle-traffic_files/figure-markdown_strict/cell-14-output-1.png 1.5x, seattle-bicycle-traffic_files/figure-markdown_strict/cell-14-output-1.png 2x"
        data-sizes="auto"
        alt="seattle-bicycle-traffic_files/figure-markdown_strict/cell-14-output-1.png"
        title="seattle-bicycle-traffic_files/figure-markdown_strict/cell-14-output-1.png" /></p>
<p>First plot shows a sharp bimodal pattern, indicative of a communing pattern (with the majority of people riding west in the morning and east in the evening), while the second plot shows a wide unimodel pattern, indicative of weekend days and holidays.</p>
<h3 id="uncovering-work-habits">Uncovering work habits</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Check whether two clusters correspond to weekend and weekdays</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dayofweek</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">pivoted</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">dayofweek</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Xpca</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">Xpca</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">dayofweek</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&#34;Paired&#34;</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">cb</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="s2">&#34;Mo&#34;</span><span class="p">,</span> <span class="s2">&#34;Tu&#34;</span><span class="p">,</span> <span class="s2">&#34;We&#34;</span><span class="p">,</span> <span class="s2">&#34;Th&#34;</span><span class="p">,</span> <span class="s2">&#34;Fr&#34;</span><span class="p">,</span> <span class="s2">&#34;Sa&#34;</span><span class="p">,</span> <span class="s2">&#34;Su&#34;</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="seattle-bicycle-traffic_files/figure-markdown_strict/cell-15-output-1.png"
        data-srcset="seattle-bicycle-traffic_files/figure-markdown_strict/cell-15-output-1.png, seattle-bicycle-traffic_files/figure-markdown_strict/cell-15-output-1.png 1.5x, seattle-bicycle-traffic_files/figure-markdown_strict/cell-15-output-1.png 2x"
        data-sizes="auto"
        alt="seattle-bicycle-traffic_files/figure-markdown_strict/cell-15-output-1.png"
        title="seattle-bicycle-traffic_files/figure-markdown_strict/cell-15-output-1.png" /></p>
<p>Let&rsquo;s look more closely at weekdays that follow a weekend pattern, of which there are a few.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;cluster&#34;</span><span class="p">:</span> <span class="n">pivoted</span><span class="p">[</span><span class="s2">&#34;cluster&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;is_weekend&#34;</span><span class="p">:</span> <span class="p">(</span><span class="n">dayofweek</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;weekday&#34;</span><span class="p">:</span> <span class="n">pivoted</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">%a</span><span class="s2">&#34;</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">results</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
<thead>
<tr>
<th></th>
<th>cluster</th>
<th>is_weekend</th>
<th>weekday</th>
</tr>
</thead>
<tbody>
<tr>
<td>2012-10-03</td>
<td>0</td>
<td>False</td>
<td>Wed</td>
</tr>
<tr>
<td>2012-10-04</td>
<td>0</td>
<td>False</td>
<td>Thu</td>
</tr>
<tr>
<td>2012-10-05</td>
<td>0</td>
<td>False</td>
<td>Fri</td>
</tr>
<tr>
<td>2012-10-06</td>
<td>1</td>
<td>True</td>
<td>Sat</td>
</tr>
<tr>
<td>2012-10-07</td>
<td>1</td>
<td>True</td>
<td>Sun</td>
</tr>
</tbody>
</table>
</div>
<p>Count number of weekend days with a workday pattern</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">weekend_workdays</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;cluster == 0 and is_weekend&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">len</span><span class="p">(</span><span class="n">weekend_workdays</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>0
</code></pre>
<p>Count number of week days that fall into the weekend / holiday pattern</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">weekday_holidays</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;cluster == 1 and not is_weekend&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">len</span><span class="p">(</span><span class="n">weekday_holidays</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>23
</code></pre>
<p>There were zero weekend days where people in Seattle decided to work, but 23 weekdays that appear to be public holidasy. Let&rsquo;s have a look.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Download list of public holidays</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cal</span> <span class="o">=</span> <span class="n">USFederalHolidayCalendar</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">holidays</span> <span class="o">=</span> <span class="n">cal</span><span class="o">.</span><span class="n">holidays</span><span class="p">(</span><span class="s2">&#34;2012&#34;</span><span class="p">,</span> <span class="s2">&#34;2016&#34;</span><span class="p">,</span> <span class="n">return_name</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">holidays</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>2012-01-02                 New Years Day
2012-01-16    Martin Luther King Jr. Day
2012-02-20                Presidents Day
2012-05-28                  Memorial Day
2012-07-04                      July 4th
dtype: object
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Add the days before and after holidays to the list</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">holidays_all</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="n">holidays</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Day before &#34;</span> <span class="o">+</span> <span class="n">holidays</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;D&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Day after &#34;</span> <span class="o">+</span> <span class="n">holidays</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;D&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">holidays_all</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">holidays_all</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>2012-01-01                 Day before New Years Day
2012-01-02                            New Years Day
2012-01-03                  Day after New Years Day
2012-01-15    Day before Martin Luther King Jr. Day
2012-01-16               Martin Luther King Jr. Day
dtype: object
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># A list of holidays on which people in Seattle skip work</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">holidays_all</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;name&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">joined</span> <span class="o">=</span> <span class="n">weekday_holidays</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">holidays_all</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">set</span><span class="p">(</span><span class="n">joined</span><span class="p">[</span><span class="s2">&#34;name&#34;</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>{'Christmas',
 'Day after Christmas',
 'Day after Thanksgiving',
 'Day before Christmas',
 'July 4th',
 'Labor Day',
 'Memorial Day',
 'New Years Day',
 'Thanksgiving'}
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># A list of holidays on which people in Seattle do go to work</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">set</span><span class="p">(</span><span class="n">holidays</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">joined</span><span class="p">[</span><span class="s2">&#34;name&#34;</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>{'Columbus Day',
 'Martin Luther King Jr. Day',
 'Presidents Day',
 'Veterans Day'}
</code></pre>
<h3 id="whats-up-with-fridays">What&rsquo;s up with Fridays?</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Plot Fridays separately</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">fridays</span> <span class="o">=</span> <span class="n">dayofweek</span> <span class="o">==</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Xpca</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">Xpca</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">&#34;gray&#34;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Xpca</span><span class="p">[</span><span class="n">fridays</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">Xpca</span><span class="p">[</span><span class="n">fridays</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">&#34;green&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>&lt;matplotlib.collections.PathCollection at 0x1a26303c10&gt;
</code></pre>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="seattle-bicycle-traffic_files/figure-markdown_strict/cell-23-output-2.png"
        data-srcset="seattle-bicycle-traffic_files/figure-markdown_strict/cell-23-output-2.png, seattle-bicycle-traffic_files/figure-markdown_strict/cell-23-output-2.png 1.5x, seattle-bicycle-traffic_files/figure-markdown_strict/cell-23-output-2.png 2x"
        data-sizes="auto"
        alt="seattle-bicycle-traffic_files/figure-markdown_strict/cell-23-output-2.png"
        title="seattle-bicycle-traffic_files/figure-markdown_strict/cell-23-output-2.png" /></p>
<p>What&rsquo;s going on with the three strange outliers in the right bottom corner?</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Get dates for the three outliers</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">weird_fridays</span> <span class="o">=</span> <span class="n">pivoted</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">fridays</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Xpca</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">900</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">weird_fridays</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>Index([2013-05-17, 2014-05-16, 2015-05-15], dtype='object')
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Plot pattern for three outliers relative to average Friday</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">all_days</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="s2">&#34;total&#34;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">all_days</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">weird_fridays</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">all_days</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&#34;grey&#34;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="n">hourly_ticks</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1a2631b750&gt;
</code></pre>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="seattle-bicycle-traffic_files/figure-markdown_strict/cell-25-output-2.png"
        data-srcset="seattle-bicycle-traffic_files/figure-markdown_strict/cell-25-output-2.png, seattle-bicycle-traffic_files/figure-markdown_strict/cell-25-output-2.png 1.5x, seattle-bicycle-traffic_files/figure-markdown_strict/cell-25-output-2.png 2x"
        data-sizes="auto"
        alt="seattle-bicycle-traffic_files/figure-markdown_strict/cell-25-output-2.png"
        title="seattle-bicycle-traffic_files/figure-markdown_strict/cell-25-output-2.png" /></p>
<p>We&rsquo;ve found Seattle&rsquo;s <a href="https://www.cascade.org/bikeeverywhereday" target="_blank" rel="noopener noreffer ">bike to work day</a>.</p>
<h2 id="supervised-modeling">Supervised modeling</h2>
<p>This part contains my replication of <a href="https://jakevdp.github.io/blog/2014/06/10/is-seattle-really-seeing-an-uptick-in-cycling/" target="_blank" rel="noopener noreffer ">this</a> blog post by <a href="http://vanderplas.com/" target="_blank" rel="noopener noreffer ">Jake VanderPlan</a> on using data from bicycle traffic across Seattle&rsquo;s Fremont Bridge to learn about commuting patterns.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&#34;seaborn&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">seattlecycling.data</span> <span class="kn">import</span> <span class="n">get_fremont_data</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">seattlecycling.toolbox</span> <span class="kn">import</span> <span class="n">hours_of_daylight</span><span class="p">,</span> <span class="n">print_rms</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Load data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">start</span> <span class="o">=</span> <span class="s2">&#34;1 Oct 2012&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">end</span> <span class="o">=</span> <span class="s2">&#34;15 May 2014&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="n">get_fremont_data</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
<thead>
<tr>
<th></th>
<th>total</th>
<th>west</th>
<th>east</th>
</tr>
</thead>
<tbody>
<tr>
<td>Date</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>2012-10-03 00:00:00</td>
<td>13.0</td>
<td>4.0</td>
<td>9.0</td>
</tr>
<tr>
<td>2012-10-03 01:00:00</td>
<td>10.0</td>
<td>4.0</td>
<td>6.0</td>
</tr>
<tr>
<td>2012-10-03 02:00:00</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
</tbody>
</table>
</div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Resample data into daily and weekly totals</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">daily</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&#34;d&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">weekly</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&#34;w&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># A first look at the data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">weekly</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&#34;Weekly rides&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="seattle-bicycle-traffic_files/figure-markdown_strict/cell-29-output-1.png"
        data-srcset="seattle-bicycle-traffic_files/figure-markdown_strict/cell-29-output-1.png, seattle-bicycle-traffic_files/figure-markdown_strict/cell-29-output-1.png 1.5x, seattle-bicycle-traffic_files/figure-markdown_strict/cell-29-output-1.png 2x"
        data-sizes="auto"
        alt="seattle-bicycle-traffic_files/figure-markdown_strict/cell-29-output-1.png"
        title="seattle-bicycle-traffic_files/figure-markdown_strict/cell-29-output-1.png" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Look at rolling weekly mean to smooth out short-term variation</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&#34;d&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="seattle-bicycle-traffic_files/figure-markdown_strict/cell-30-output-1.png"
        data-srcset="seattle-bicycle-traffic_files/figure-markdown_strict/cell-30-output-1.png, seattle-bicycle-traffic_files/figure-markdown_strict/cell-30-output-1.png 1.5x, seattle-bicycle-traffic_files/figure-markdown_strict/cell-30-output-1.png 2x"
        data-sizes="auto"
        alt="seattle-bicycle-traffic_files/figure-markdown_strict/cell-30-output-1.png"
        title="seattle-bicycle-traffic_files/figure-markdown_strict/cell-30-output-1.png" /></p>
<p>Blog post points out that 2014 has seen increased cycle traffic across the bridge. Below we&rsquo;re modelling seasonal variation based on what we think influences peoples&rsquo; decision whether or not to ride a bike.</p>
<h3 id="accounting-for-hours-of-daylight">Accounting for hours of daylight</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Hours of daylight</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">weekly</span><span class="p">[</span><span class="s2">&#34;daylight&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">hours_of_daylight</span><span class="p">,</span> <span class="n">weekly</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">daily</span><span class="p">[</span><span class="s2">&#34;daylight&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">hours_of_daylight</span><span class="p">,</span> <span class="n">daily</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">weekly</span><span class="p">[</span><span class="s2">&#34;daylight&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&#34;Hours of daylight (Seattle)&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="seattle-bicycle-traffic_files/figure-markdown_strict/cell-31-output-1.png"
        data-srcset="seattle-bicycle-traffic_files/figure-markdown_strict/cell-31-output-1.png, seattle-bicycle-traffic_files/figure-markdown_strict/cell-31-output-1.png 1.5x, seattle-bicycle-traffic_files/figure-markdown_strict/cell-31-output-1.png 2x"
        data-sizes="auto"
        alt="seattle-bicycle-traffic_files/figure-markdown_strict/cell-31-output-1.png"
        title="seattle-bicycle-traffic_files/figure-markdown_strict/cell-31-output-1.png" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Relationship between daylight and cycle traffic</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">weekly</span><span class="o">.</span><span class="n">daylight</span><span class="p">,</span> <span class="n">weekly</span><span class="o">.</span><span class="n">total</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&#34;Hours of daylight&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&#34;Weekly bicycle traffic&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="seattle-bicycle-traffic_files/figure-markdown_strict/cell-32-output-1.png"
        data-srcset="seattle-bicycle-traffic_files/figure-markdown_strict/cell-32-output-1.png, seattle-bicycle-traffic_files/figure-markdown_strict/cell-32-output-1.png 1.5x, seattle-bicycle-traffic_files/figure-markdown_strict/cell-32-output-1.png 2x"
        data-sizes="auto"
        alt="seattle-bicycle-traffic_files/figure-markdown_strict/cell-32-output-1.png"
        title="seattle-bicycle-traffic_files/figure-markdown_strict/cell-32-output-1.png" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Adding a linear trend</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">X</span> <span class="o">=</span> <span class="n">weekly</span><span class="p">[[</span><span class="s2">&#34;daylight&#34;</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="n">weekly</span><span class="p">[</span><span class="s2">&#34;total&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">clf</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">(</span><span class="n">fit_intercept</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">weekly</span><span class="p">[</span><span class="s2">&#34;daylight_trend&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">weekly</span><span class="p">[</span><span class="s2">&#34;daylight_corrected_total&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">weekly</span><span class="o">.</span><span class="n">total</span> <span class="o">-</span> <span class="n">weekly</span><span class="o">.</span><span class="n">daylight_trend</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">weekly</span><span class="o">.</span><span class="n">daylight_trend</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">xfit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">yfit</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">xfit</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">weekly</span><span class="o">.</span><span class="n">daylight</span><span class="p">,</span> <span class="n">weekly</span><span class="o">.</span><span class="n">total</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xfit</span><span class="p">,</span> <span class="n">yfit</span><span class="p">,</span> <span class="s2">&#34;-k&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;Bycicle traffic through the year&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&#34;Hours of daylight&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&#34;Weekly bicycle traffic&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="seattle-bicycle-traffic_files/figure-markdown_strict/cell-33-output-1.png"
        data-srcset="seattle-bicycle-traffic_files/figure-markdown_strict/cell-33-output-1.png, seattle-bicycle-traffic_files/figure-markdown_strict/cell-33-output-1.png 1.5x, seattle-bicycle-traffic_files/figure-markdown_strict/cell-33-output-1.png 2x"
        data-sizes="auto"
        alt="seattle-bicycle-traffic_files/figure-markdown_strict/cell-33-output-1.png"
        title="seattle-bicycle-traffic_files/figure-markdown_strict/cell-33-output-1.png" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">clf</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>1966.2003072317068
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Plot detrended data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">trend</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">weekly</span><span class="p">[[</span><span class="s2">&#34;daylight&#34;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">weekly</span><span class="o">.</span><span class="n">daylight</span><span class="p">,</span> <span class="n">weekly</span><span class="o">.</span><span class="n">total</span> <span class="o">-</span> <span class="n">trend</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">trend</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xfit</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">trend</span><span class="p">)</span> <span class="o">+</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">yfit</span><span class="p">,</span> <span class="s2">&#34;-k&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;Weekly traffic through the year (detrended)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&#34;Hours of daylight&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&#34;Adjusted weekly bicycle traffic&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="seattle-bicycle-traffic_files/figure-markdown_strict/cell-35-output-1.png"
        data-srcset="seattle-bicycle-traffic_files/figure-markdown_strict/cell-35-output-1.png, seattle-bicycle-traffic_files/figure-markdown_strict/cell-35-output-1.png 1.5x, seattle-bicycle-traffic_files/figure-markdown_strict/cell-35-output-1.png 2x"
        data-sizes="auto"
        alt="seattle-bicycle-traffic_files/figure-markdown_strict/cell-35-output-1.png"
        title="seattle-bicycle-traffic_files/figure-markdown_strict/cell-35-output-1.png" /></p>
<p>In the graph above, we have removed the number of riders per week that correlate with the number of hours of daylight, so that we can think of what is shown of the number of rides per week we&rsquo;d expect to see if daylight was not an issue.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">fix</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">weekly</span><span class="p">[[</span><span class="s2">&#34;total&#34;</span><span class="p">,</span> <span class="s2">&#34;daylight_trend&#34;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">weekly</span><span class="p">[</span><span class="s2">&#34;daylight_corrected_total&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&#34;Weekly crossing&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&#34;Total weekly crossings and trend&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&#34;Adjusted weekly crossings&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&#34;Detrended weekly crossings&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">print_rms</span><span class="p">(</span><span class="n">weekly</span><span class="p">[</span><span class="s2">&#34;daylight_corrected_total&#34;</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>Root-mean-square about trend:  2872 riders
</code></pre>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="seattle-bicycle-traffic_files/figure-markdown_strict/cell-36-output-2.png"
        data-srcset="seattle-bicycle-traffic_files/figure-markdown_strict/cell-36-output-2.png, seattle-bicycle-traffic_files/figure-markdown_strict/cell-36-output-2.png 1.5x, seattle-bicycle-traffic_files/figure-markdown_strict/cell-36-output-2.png 2x"
        data-sizes="auto"
        alt="seattle-bicycle-traffic_files/figure-markdown_strict/cell-36-output-2.png"
        title="seattle-bicycle-traffic_files/figure-markdown_strict/cell-36-output-2.png" /></p>
<h3 id="accounting-for-day-of-the-week">Accounting for day of the week</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Plot average number of trips by weekday</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">days</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;Mon&#34;</span><span class="p">,</span> <span class="s2">&#34;Tue&#34;</span><span class="p">,</span> <span class="s2">&#34;Wed&#34;</span><span class="p">,</span> <span class="s2">&#34;Thu&#34;</span><span class="p">,</span> <span class="s2">&#34;Fri&#34;</span><span class="p">,</span> <span class="s2">&#34;Sat&#34;</span><span class="p">,</span> <span class="s2">&#34;Sun&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">daily</span><span class="p">[</span><span class="s2">&#34;dayofweek&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">daily</span><span class="p">[</span><span class="s2">&#34;total&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">dayofweek</span>
</span></span><span class="line"><span class="cl"><span class="n">grouped</span> <span class="o">=</span> <span class="n">daily</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&#34;dayofweek&#34;</span><span class="p">)[</span><span class="s2">&#34;total&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">grouped</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">days</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">grouped</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;Average crossings by weekday&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&#34;Average daily crossings&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="seattle-bicycle-traffic_files/figure-markdown_strict/cell-37-output-1.png"
        data-srcset="seattle-bicycle-traffic_files/figure-markdown_strict/cell-37-output-1.png, seattle-bicycle-traffic_files/figure-markdown_strict/cell-37-output-1.png 1.5x, seattle-bicycle-traffic_files/figure-markdown_strict/cell-37-output-1.png 2x"
        data-sizes="auto"
        alt="seattle-bicycle-traffic_files/figure-markdown_strict/cell-37-output-1.png"
        title="seattle-bicycle-traffic_files/figure-markdown_strict/cell-37-output-1.png" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Account for hours of daylight and day of week simultaneously</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Add one-hot indicators of weekdays</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">daily</span><span class="p">[</span><span class="n">days</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">daily</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">dayofweek</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Detrend on days of week and daylight together</span>
</span></span><span class="line"><span class="cl"><span class="n">X</span> <span class="o">=</span> <span class="n">daily</span><span class="p">[</span><span class="n">days</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&#34;daylight&#34;</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="n">daily</span><span class="p">[</span><span class="s2">&#34;total&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">clf</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">daily</span><span class="p">[</span><span class="s2">&#34;dayofweek_trend&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">daily</span><span class="p">[</span><span class="s2">&#34;dayofweek_corrected&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">daily</span><span class="p">[</span><span class="s2">&#34;total&#34;</span><span class="p">]</span> <span class="o">-</span> <span class="n">daily</span><span class="p">[</span><span class="s2">&#34;dayofweek_trend&#34;</span><span class="p">]</span> <span class="o">+</span> <span class="n">daily</span><span class="p">[</span><span class="s2">&#34;dayofweek_trend&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Plot crossings and trend, and detrended data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">fix</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">daily</span><span class="p">[[</span><span class="s2">&#34;total&#34;</span><span class="p">,</span> <span class="s2">&#34;dayofweek_trend&#34;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">daily</span><span class="p">[</span><span class="s2">&#34;dayofweek_corrected&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&#34;Daily crossing&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&#34;Total daily crossings and trend&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&#34;Adjusted daily crossings&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&#34;Detrended daily crossings&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">print_rms</span><span class="p">(</span><span class="n">daily</span><span class="p">[</span><span class="s2">&#34;dayofweek_corrected&#34;</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>Root-mean-square about trend:  652 riders
</code></pre>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="seattle-bicycle-traffic_files/figure-markdown_strict/cell-39-output-2.png"
        data-srcset="seattle-bicycle-traffic_files/figure-markdown_strict/cell-39-output-2.png, seattle-bicycle-traffic_files/figure-markdown_strict/cell-39-output-2.png 1.5x, seattle-bicycle-traffic_files/figure-markdown_strict/cell-39-output-2.png 2x"
        data-sizes="auto"
        alt="seattle-bicycle-traffic_files/figure-markdown_strict/cell-39-output-2.png"
        title="seattle-bicycle-traffic_files/figure-markdown_strict/cell-39-output-2.png" /></p>
<h3 id="accounting-for-rainfall-and-temparature">Accounting for rainfall and temparature</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Read in weather data</span>
</span></span><span class="line"><span class="cl"><span class="n">weather</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;seattle_weather_SeaTacWeather.csv&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">index_col</span><span class="o">=</span><span class="s2">&#34;DATE&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">weather</span> <span class="o">=</span> <span class="n">weather</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">weather</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span> <span class="n">weather</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Temparatures are in 1/10 deg F; convert to deg C</span>
</span></span><span class="line"><span class="cl"><span class="n">weather</span><span class="p">[</span><span class="s2">&#34;tmax&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">weather</span><span class="p">[</span><span class="s2">&#34;tmax&#34;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">32</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">9</span>
</span></span><span class="line"><span class="cl"><span class="n">weather</span><span class="p">[</span><span class="s2">&#34;tmin&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">weather</span><span class="p">[</span><span class="s2">&#34;tmin&#34;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">32</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">9</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Rainfall is in inches; convert to mm</span>
</span></span><span class="line"><span class="cl"><span class="n">weather</span><span class="p">[</span><span class="s2">&#34;prcp&#34;</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">25.4</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">weather</span><span class="p">[</span><span class="s2">&#34;tmax&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&#34;w&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">weather</span><span class="p">[</span><span class="s2">&#34;tmin&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&#34;w&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;Temperature extremes in Seattle&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&#34;Weekly temperature extremes (C)&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="seattle-bicycle-traffic_files/figure-markdown_strict/cell-40-output-1.png"
        data-srcset="seattle-bicycle-traffic_files/figure-markdown_strict/cell-40-output-1.png, seattle-bicycle-traffic_files/figure-markdown_strict/cell-40-output-1.png 1.5x, seattle-bicycle-traffic_files/figure-markdown_strict/cell-40-output-1.png 2x"
        data-sizes="auto"
        alt="seattle-bicycle-traffic_files/figure-markdown_strict/cell-40-output-1.png"
        title="seattle-bicycle-traffic_files/figure-markdown_strict/cell-40-output-1.png" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">weather</span><span class="p">[</span><span class="s2">&#34;prcp&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&#34;w&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;Precipitation in Seattle&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&#34;Weekly precipitation in Seattle (mm)&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="seattle-bicycle-traffic_files/figure-markdown_strict/cell-41-output-1.png"
        data-srcset="seattle-bicycle-traffic_files/figure-markdown_strict/cell-41-output-1.png, seattle-bicycle-traffic_files/figure-markdown_strict/cell-41-output-1.png 1.5x, seattle-bicycle-traffic_files/figure-markdown_strict/cell-41-output-1.png 2x"
        data-sizes="auto"
        alt="seattle-bicycle-traffic_files/figure-markdown_strict/cell-41-output-1.png"
        title="seattle-bicycle-traffic_files/figure-markdown_strict/cell-41-output-1.png" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Combine daily and weather dataset</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">daily</span> <span class="o">=</span> <span class="n">daily</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">weather</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Detrend data including weather information</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">columns</span> <span class="o">=</span> <span class="n">days</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&#34;daylight&#34;</span><span class="p">,</span> <span class="s2">&#34;tmax&#34;</span><span class="p">,</span> <span class="s2">&#34;tmin&#34;</span><span class="p">,</span> <span class="s2">&#34;prcp&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">X</span> <span class="o">=</span> <span class="n">daily</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="n">daily</span><span class="p">[</span><span class="s2">&#34;total&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">clf</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">daily</span><span class="p">[</span><span class="s2">&#34;overall_trend&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">daily</span><span class="p">[</span><span class="s2">&#34;overall_corrected&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">daily</span><span class="p">[</span><span class="s2">&#34;total&#34;</span><span class="p">]</span> <span class="o">-</span> <span class="n">daily</span><span class="p">[</span><span class="s2">&#34;overall_trend&#34;</span><span class="p">]</span> <span class="o">+</span> <span class="n">daily</span><span class="p">[</span><span class="s2">&#34;overall_trend&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Plot crossings and trend, and detrended data</span>
</span></span><span class="line"><span class="cl"><span class="n">fix</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">daily</span><span class="p">[[</span><span class="s2">&#34;total&#34;</span><span class="p">,</span> <span class="s2">&#34;overall_trend&#34;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">daily</span><span class="p">[</span><span class="s2">&#34;overall_corrected&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&#34;Daily crossing&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&#34;Total daily crossings and trend&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&#34;Adjusted daily crossings&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&#34;Detrended daily crossings&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">print_rms</span><span class="p">(</span><span class="n">daily</span><span class="p">[</span><span class="s2">&#34;overall_corrected&#34;</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>Root-mean-square about trend:  457 riders
</code></pre>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="seattle-bicycle-traffic_files/figure-markdown_strict/cell-44-output-2.png"
        data-srcset="seattle-bicycle-traffic_files/figure-markdown_strict/cell-44-output-2.png, seattle-bicycle-traffic_files/figure-markdown_strict/cell-44-output-2.png 1.5x, seattle-bicycle-traffic_files/figure-markdown_strict/cell-44-output-2.png 2x"
        data-sizes="auto"
        alt="seattle-bicycle-traffic_files/figure-markdown_strict/cell-44-output-2.png"
        title="seattle-bicycle-traffic_files/figure-markdown_strict/cell-44-output-2.png" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Plot rolling 30 day average</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">daily</span><span class="p">[</span><span class="s2">&#34;overall_corrected&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;1-month moving average&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="seattle-bicycle-traffic_files/figure-markdown_strict/cell-45-output-1.png"
        data-srcset="seattle-bicycle-traffic_files/figure-markdown_strict/cell-45-output-1.png, seattle-bicycle-traffic_files/figure-markdown_strict/cell-45-output-1.png 1.5x, seattle-bicycle-traffic_files/figure-markdown_strict/cell-45-output-1.png 2x"
        data-sizes="auto"
        alt="seattle-bicycle-traffic_files/figure-markdown_strict/cell-45-output-1.png"
        title="seattle-bicycle-traffic_files/figure-markdown_strict/cell-45-output-1.png" /></p>
<h3 id="accounting-for-a-steady-increase-in-riders">Accounting for a steady increase in riders</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">daily</span><span class="p">[</span><span class="s2">&#34;daycount&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">daily</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">columns</span> <span class="o">=</span> <span class="n">days</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&#34;daycount&#34;</span><span class="p">,</span> <span class="s2">&#34;daylight&#34;</span><span class="p">,</span> <span class="s2">&#34;tmax&#34;</span><span class="p">,</span> <span class="s2">&#34;tmin&#34;</span><span class="p">,</span> <span class="s2">&#34;prcp&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">X</span> <span class="o">=</span> <span class="n">daily</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="n">daily</span><span class="p">[</span><span class="s2">&#34;total&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">final_model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">daily</span><span class="p">[</span><span class="s2">&#34;final_trend&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">daily</span><span class="p">[</span><span class="s2">&#34;final_corrected&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">daily</span><span class="p">[</span><span class="s2">&#34;total&#34;</span><span class="p">]</span> <span class="o">-</span> <span class="n">daily</span><span class="p">[</span><span class="s2">&#34;final_trend&#34;</span><span class="p">]</span> <span class="o">+</span> <span class="n">daily</span><span class="p">[</span><span class="s2">&#34;final_trend&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Plot crossings and trend, and detrended data</span>
</span></span><span class="line"><span class="cl"><span class="n">fix</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">daily</span><span class="p">[[</span><span class="s2">&#34;total&#34;</span><span class="p">,</span> <span class="s2">&#34;final_trend&#34;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">daily</span><span class="p">[</span><span class="s2">&#34;final_corrected&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&#34;Daily crossing&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&#34;Total daily crossings and trend&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&#34;Adjusted daily crossings&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&#34;Detrended daily crossings&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">print_rms</span><span class="p">(</span><span class="n">daily</span><span class="p">[</span><span class="s2">&#34;final_corrected&#34;</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>Root-mean-square about trend:  451 riders
</code></pre>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="seattle-bicycle-traffic_files/figure-markdown_strict/cell-47-output-2.png"
        data-srcset="seattle-bicycle-traffic_files/figure-markdown_strict/cell-47-output-2.png, seattle-bicycle-traffic_files/figure-markdown_strict/cell-47-output-2.png 1.5x, seattle-bicycle-traffic_files/figure-markdown_strict/cell-47-output-2.png 2x"
        data-sizes="auto"
        alt="seattle-bicycle-traffic_files/figure-markdown_strict/cell-47-output-2.png"
        title="seattle-bicycle-traffic_files/figure-markdown_strict/cell-47-output-2.png" /></p>
<h3 id="what-can-the-final-model-tell-us">What can the final model tell us?</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Compute error variance</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">vy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y</span> <span class="o">-</span> <span class="n">daily</span><span class="p">[</span><span class="s2">&#34;final_trend&#34;</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))])</span>
</span></span><span class="line"><span class="cl"><span class="n">C</span> <span class="o">=</span> <span class="n">vy</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X2</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">X2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">var</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="how-does-rain-affect-ridership">How does rain affect ridership?</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ind</span> <span class="o">=</span> <span class="n">columns</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&#34;prcp&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">slope</span> <span class="o">=</span> <span class="n">final_model</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;</span><span class="si">{0: .0f}</span><span class="s2"> +/- </span><span class="si">{1: .0f}</span><span class="s2"> daily crossings lost per cm of rain&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="o">-</span><span class="n">slope</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="n">error</span> <span class="o">*</span> <span class="mi">10</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code> 331 +/-  28 daily crossings lost per cm of rain
</code></pre>
<p>The model shows that for every cm of rain, about 300 cyclists stay home or use another mode of transport.</p>
<h4 id="how-does-temparature-affect-ridership">How does temparature affect ridership?</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span> <span class="o">=</span> <span class="n">columns</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&#34;tmin&#34;</span><span class="p">),</span> <span class="n">columns</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&#34;tmax&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">slope</span> <span class="o">=</span> <span class="n">final_model</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="n">ind1</span><span class="p">]</span> <span class="o">+</span> <span class="n">final_model</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="n">ind2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="n">ind1</span><span class="p">]</span> <span class="o">+</span> <span class="n">var</span><span class="p">[</span><span class="n">ind2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;</span><span class="si">{0:.0f}</span><span class="s2"> +/- </span><span class="si">{1:.0f}</span><span class="s2"> riders per ten degrees Celsius&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">slope</span><span class="p">,</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>493 +/- 102 riders per ten degrees Celsius
</code></pre>
<h4 id="how-does-daylight-affect-ridership">How does daylight affect ridership?</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ind</span> <span class="o">=</span> <span class="n">columns</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&#34;daylight&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">slopt</span> <span class="o">=</span> <span class="n">final_model</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">{0:.0f}</span><span class="s2"> +/- </span><span class="si">{1:.0f}</span><span class="s2"> riders per hour of daylight&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">slope</span><span class="p">,</span> <span class="n">error</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>49 +/- 12 riders per hour of daylight
</code></pre>
<h4 id="is-ridership-increasing">Is ridership increasing?</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ind</span> <span class="o">=</span> <span class="n">columns</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&#34;daycount&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">slope</span> <span class="o">=</span> <span class="n">final_model</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">{0:.2f}</span><span class="s2"> +/- </span><span class="si">{1:.2f}</span><span class="s2"> new riders per day&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">slope</span><span class="p">,</span> <span class="n">error</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">{0:.1f}</span><span class="s2"> +/- </span><span class="si">{1:.1f}</span><span class="s2"> new riders per week&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">7</span> <span class="o">*</span> <span class="n">slope</span><span class="p">,</span> <span class="mi">7</span> <span class="o">*</span> <span class="n">error</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;annual change: (</span><span class="si">{0:.0f}</span><span class="s2"> +/- </span><span class="si">{1:.0f}</span><span class="s2">)%&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="mi">100</span> <span class="o">*</span> <span class="mi">365</span> <span class="o">*</span> <span class="n">slope</span> <span class="o">/</span> <span class="n">daily</span><span class="p">[</span><span class="s2">&#34;total&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">        <span class="mi">100</span> <span class="o">*</span> <span class="mi">365</span> <span class="o">*</span> <span class="n">error</span> <span class="o">/</span> <span class="n">daily</span><span class="p">[</span><span class="s2">&#34;total&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>0.43 +/- 0.11 new riders per day
3.0 +/- 0.8 new riders per week
annual change: (7 +/- 2)%
</code></pre>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2023-10-02</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/datascience/">datascience</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/waiting-time-paradox/" class="prev" rel="prev" title="Waiting time paradox"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Waiting time paradox</a>
            <a href="/aws/" class="next" rel="next" title="AWS">AWS<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.111.3">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2019 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank"></a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
